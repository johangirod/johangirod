<!doctype html>
<html lang="fr">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="../../../../favicon.png" />

		<meta name="viewport" content="width=device-width" />
		
		<link href="../../../../_app/immutable/assets/0.DeOizrWX.css" rel="stylesheet">
		<link href="../../../../_app/immutable/assets/2.Dz1qT87F.css" rel="stylesheet">
		<link rel="modulepreload" href="../../../../_app/immutable/entry/start.Bnp5303b.js">
		<link rel="modulepreload" href="../../../../_app/immutable/chunks/Cugo8Sw9.js">
		<link rel="modulepreload" href="../../../../_app/immutable/chunks/_Roc1N7j.js">
		<link rel="modulepreload" href="../../../../_app/immutable/chunks/Du4uIILg.js">
		<link rel="modulepreload" href="../../../../_app/immutable/chunks/DYGiXs1v.js">
		<link rel="modulepreload" href="../../../../_app/immutable/entry/app.gFT0rYy9.js">
		<link rel="modulepreload" href="../../../../_app/immutable/chunks/jKjWACjA.js">
		<link rel="modulepreload" href="../../../../_app/immutable/chunks/CozvbqRy.js">
		<link rel="modulepreload" href="../../../../_app/immutable/chunks/CU3E0FLs.js">
		<link rel="modulepreload" href="../../../../_app/immutable/chunks/B4pklceG.js">
		<link rel="modulepreload" href="../../../../_app/immutable/chunks/pFiT_qqh.js">
		<link rel="modulepreload" href="../../../../_app/immutable/nodes/0.BjDQT2Bq.js">
		<link rel="modulepreload" href="../../../../_app/immutable/chunks/CMei0t4b.js">
		<link rel="modulepreload" href="../../../../_app/immutable/chunks/Bgovi1YL.js">
		<link rel="modulepreload" href="../../../../_app/immutable/chunks/D4AmcDfz.js">
		<link rel="modulepreload" href="../../../../_app/immutable/nodes/2.CBLjlu0K.js">
		<link rel="modulepreload" href="../../../../_app/immutable/chunks/B0BGekoV.js">
		<link rel="modulepreload" href="../../../../_app/immutable/chunks/BMkXc6el.js">
		<link rel="modulepreload" href="../../../../_app/immutable/chunks/Cv3pZryr.js">
		<link rel="modulepreload" href="../../../../_app/immutable/nodes/21.Bd4xUNeA.js">
		<link rel="modulepreload" href="../../../../_app/immutable/chunks/Cs1o_ong.js">
		<link rel="modulepreload" href="../../../../_app/immutable/chunks/DyuDGlf2.js">
		<link rel="modulepreload" href="../../../../_app/immutable/chunks/OjqImkSQ.js"><!--[--><!--]--><title>Johan Girod</title>
	</head>
	<body data-sveltekit-preload-data="hover">
		<div style="display: contents"><!--[--><!--[--><!----><div class="screen:container prose-h2 container prose prose-slate mx-auto my-12 px-4 lg:prose-xl prose-headings:text-slate-800 prose-h1:font-semibold prose-a:transition prose-a:duration-75 hover:prose-a:text-pink-500 lg:px-0 print:mx-0 print:max-w-none"><!----><!--[--><!----><div class="lg:prose-lg"><div style="view-transition-name: breadcrumb"><div class="mb-2 inline" role="list"><!--[--><li class="inline-block"><a href="/" class="text-pink-600" aria-label="Accueil">Accueil</a> <!--[--><span class="mx-2 text-gray-500">/</span><!--]--></li><li class="inline-block"><a href="/cours/" class="text-pink-600" aria-label="Cours et TP">Cours et TP</a> <!--[--><span class="mx-2 text-gray-500">/</span><!--]--></li><li class="inline-block"><a href="http://sveltekit-prerender/cours/tw3/eval/2024/" class="text-pink-600" aria-label="...">...</a> <!--[!--><!--]--></li><!--]--></div><!----> <!--[!--><!--]--></div> <main class="mt-8 prose-h1:inline-block prose-h1:border-y-8 prose-h1:border-pink-500 prose-h1:px-2 prose-h1:pb-3 prose-h1:pt-2 prose-h1:text-4xl prose-h2:text-3xl"><!----><!--[!--><!----><h1>Evaluation TW3 2024</h1> <div class="bg-blue-100 border-l-4 border-blue-500 px-4 py-2"><p class="font-bold text-blue-700"><!----><div slot="title">Rattrapage du devoir</div><!----></p> <!----><p>Vous avez la possibilité de <strong>rattraper ce devoir à la maison</strong>.</p> <ul><li>Selectionner <strong>un ou plusieurs exercices</strong> que vous n’avez pas réussi à faire (vous pouvez refaire tout le devoir si vous le souhaitez)</li> <li>Faire <strong>passer les tests</strong> au vert</li> <li><strong>Commentez chaque ligne</strong> ajoutée en expliquant ce que vous avez fait</li> <li>Les points rattrapés ainsi compteront pour <strong>moitié de leur valeur initiale</strong></li></ul> <p><em>Exemple : Si vous aviez une note initiale de 8/20, et que votre rattrapage vous augmente la note de 5 points (en faisant passer à 13), votre note finale sera 8 + (5 / 2) = 10.5</em></p> <p><strong>Pour récupérer son travail</strong></p> <ul><li><code>git clone https://sources.univ-jfc.fr/techno-web-3/eval-2024.git</code></li> <li><code>cd eval-2024</code></li> <li><code>git fetch</code></li> <li>Cherchez le nom de votre branche dans la <a href="https://sources.univ-jfc.fr/techno-web-3/eval-2024/-/branches" rel="nofollow">liste des branches du repo</a></li> <li><code>git checkout &lt;nom_de_votre_branche></code> (exemple : <code>git checkout jgirod</code>)</li></ul> <p><strong>Pour sauvegarder votre travail</strong></p> <ul><li><code>git add -A *</code></li> <li><code>git commit -m "Rattrapage"</code></li> <li><code>git push origin &lt;nom_de_votre_branche></code></li></ul><!----></div><!----> <p>Dans ce TP, vous aurez à réaliser un site web qui répertorie les concerts et soirées dans les grandes villes de France, et qui permet d’acheter des billets pour ces événements.</p> <p>Vous devrez réaliser les fonctionnalités suivantes :</p> <ul><li>Affichage de la liste des événements</li> <li>Afficher les billets achetés par un utilisateur depuis la base de donnée</li> <li>Formulaire pour acheter un billet</li></ul> <h2>Information et consignes générales</h2> <p><strong>Important</strong> : lisez attentivement cette section avant de commencer le TP</p> <ul><li>Vous pouvez utiliser <a href="https://johangirod.com/cours" rel="nofollow"><strong>les corrigés</strong> des TPs précédents</a></li> <li>Vous pouvez utiliser <strong>internet</strong> librement</li> <li>Vous ne <strong>pouvez pas communiquer</strong> entre vous</li> <li>Vous ne pouvez <strong>pas utiliser des agents conversationnels</strong> (ex: chatGPT, copilot, etc)</li> <li>Vous pouvez solliciter l’enseignant pour toute question relative à la <strong>compréhension de l’énoncé</strong>, ou de lancement de l’application (base de données, container, etc), ou si vous pensez avoir <strong>trouvé une erreur/bug</strong> dans l’énoncé ou les tests.</li> <li>Lisez les énoncés des exercices jusqu’au bout avant de commencer à coder, des informations importantes peuvent être données à la fin.</li> <li>Les exercices sont complètement indépendants. En cas de blocage, ou de difficultés, <strong>passez à l’exercice suivant</strong>.</li> <li>Le TP est sur 21 points (un point bonus). La note est calculée automatiquement avec les tests. Je regarderai le code si la note est inférieure à 10.</li></ul> <p><em>Le conseil bonus :</em></p> <ul><li>Faites bien attention aux erreurs liées à l’oublie de <code>await</code> devant les fonctions asynchrones.</li></ul> <h2>Installation et test</h2> <ol><li>Cloner le dépôt git suivant : <!----><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> clone</span><span style="color:#032F62"> https://sources.univ-jfc.fr/techno-web-3/eval-2024.git</span></span></code></pre><!----></li> <li>Installer les dépendances : <!----><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">npm</span><span style="color:#032F62"> install</span></span></code></pre><!----></li> <li>Initialiser la base de donnée : <!----><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">npm</span><span style="color:#032F62"> run</span><span style="color:#032F62"> db:init</span></span></code></pre><!----></li> <li>Lancez les tests : <!----><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">npm</span><span style="color:#032F62"> test</span></span></code></pre><!----></li> <li>Lancez le serveur : <!----><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">npm</span><span style="color:#032F62"> start</span></span></code></pre><!----></li></ol> <p>Si une de ces étapes ne fonctionne pas, merci de le signaler à l’enseignant.</p> <h2>Checkpoint</h2> <p>Lancer la commande suivante</p> <!----><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">npm</span><span style="color:#032F62"> run</span><span style="color:#032F62"> checkpoint</span></span></code></pre><!----> <p>Vous pourrez sauvegarder votre travail (et votre note actuelle) à tout moment grâce à cette commande. N’hésitez pas la à lancer régulièrement au fur et à mesure de vos progrès.</p> <p>Si vous rencontrez un problème, vous pourrez revenir au dernier checkpoint en l’utilisant.</p> <h2>Rendu du TP</h2> <!----><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">npm</span><span style="color:#032F62"> run</span><span style="color:#032F62"> checkpoint</span></span>
<span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> branch</span><span style="color:#D73A49"> &#x3C;</span><span style="color:#032F62">identifiant_etudian</span><span style="color:#24292E">t</span><span style="color:#D73A49">></span><span style="color:#6A737D"> # exemple : git branch jgirod</span></span>
<span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> push</span><span style="color:#032F62"> origin</span><span style="color:#D73A49"> &#x3C;</span><span style="color:#032F62">identifiant_etudian</span><span style="color:#24292E">t</span><span style="color:#D73A49">></span><span style="color:#6A737D"> # exemple : git push origin jgirod</span></span></code></pre><!----> <h2>Exercice 1 - <em>4 points</em></h2> <p><em>Pour lancer uniquement les tests de cet exercice : <code>npm test -- exercice-1</code></em></p> <ol><li>Creer une route <code>/ping</code> qui retourne un statut 200</li> <li>Servir la vue <code>home</code> sur la route <code>/</code>. Bonus : créer un controller dédié <code>getHomePage</code> dans le fichier <code>controllers.ts</code></li> <li>Monter le dossier <code>public</code> sur la route <code>/assets</code>, de tel sorte que le fichier <code>public/concert.jpg</code> soit accessible à l’url <code>/assets/concert.jpg</code></li></ol> <h2>Exercice 2 - <em>10 points</em></h2> <p><em>Pour lancer uniquement les tests de cet exercice : <code>npm test -- exercice-2</code></em></p> <h3>Partie 1 - <em>7 points</em></h3> <p>Créer une page <code>/evenements</code> qui liste l’ensemble des évenements. Vous utiliserez la fonction <code>getAllEvenements</code> pour récupérer la liste des événements (elle est déjà implémentée dans <code>models/evenements.ts</code>).</p> <p>Le type de retour de la fonction <code>getAllEvenements</code> est <code>Promise&lt;Array&lt;Evenement>></code>, vous pouvez consulter le fichier <code>models/evenements.ts</code> pour voir la structure de l’objet <code>Evenement</code>.</p> <p><strong>Consignes</strong></p> <ul><li>Le <code>&lt;title></code> de la page doit être <code>Concerts et soirées</code></li> <li>La page doit afficher comme titre <code>&lt;h2></code> : <code>Découvrez nos événements</code></li> <li>La page doit afficher la liste des événements sous forme de carte (voir proposition de HTML plus bas), contenant le titre, la description, la ville, la date, et l’image de l’événement.</li> <li>Chaque événement doit avoir un lien pour acheter un billet. Ce lien doit rediriger vers la page <code>/evenements/&lt;id>/acheter-billet</code> (où <code>&lt;id></code> est l’id de l’événement). Par exemple pour l’événement d’id 12, le lien doit rediriger vers <code>/evenements/12/acheter-billet/</code></li> <li>La page doit être servie via un controller dédié <code>getEvenementsPage</code> dans le fichier <code>controllers.ts</code></li> <li>Pour formater la date en français avec handlebar, vous pouvez utiliser le helper <code>formatDate</code>. Par exemple, si le nom de la propriété est <code>maDate</code>, vous pouvez la formater directement dans la vue en utilisant <code>{{ formatDate maDate }}</code></li></ul> <p><strong>Proposition de HTML pour la page <code>/evenement</code> :</strong></p> <!----><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">&#x3C;</span><span style="color:#22863A">div</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">"container mx-auto px-6 py-12"</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">	&#x3C;</span><span style="color:#22863A">h2</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">"mb-8 text-center text-4xl font-bold"</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#6A737D">		&#x3C;!-- Titre h2 --></span></span>
<span class="line"><span style="color:#24292E">	&#x3C;/</span><span style="color:#22863A">h2</span><span style="color:#24292E">></span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">	&#x3C;</span><span style="color:#22863A">div</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">"grid grid-cols-1 gap-8 md:grid-cols-2 lg:grid-cols-3"</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#6A737D">		&#x3C;!-- Liste des évènements ici --></span></span>
<span class="line"><span style="color:#24292E">	&#x3C;/</span><span style="color:#22863A">div</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">&#x3C;/</span><span style="color:#22863A">div</span><span style="color:#24292E">></span></span></code></pre><!----> <p><strong>Proposition de HTML pour un évènement (à transformer en template handlebar) :</strong></p> <!----><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">&#x3C;</span><span style="color:#22863A">div</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">"flex h-full flex-col overflow-hidden rounded-xl bg-white text-purple-900 shadow-xl"</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">	&#x3C;</span><span style="color:#22863A">img</span><span style="color:#6F42C1"> src</span><span style="color:#24292E">=</span><span style="color:#032F62">""</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">"h-48 w-full object-cover"</span><span style="color:#24292E"> /></span></span>
<span class="line"><span style="color:#6A737D">	&#x3C;!-- Modifier la src de l'image ci-dessus --></span></span>
<span class="line"><span style="color:#24292E">	&#x3C;</span><span style="color:#22863A">div</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">"flex flex-grow flex-col p-6"</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">		&#x3C;</span><span style="color:#22863A">h3</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">"mb-2 text-xl font-semibold"</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#6A737D">			&#x3C;!-- Titre de l'évènement ici --></span></span>
<span class="line"><span style="color:#24292E">		&#x3C;/</span><span style="color:#22863A">h3</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">		&#x3C;</span><span style="color:#22863A">p</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">"mb-4 flex-grow text-gray-600"</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#6A737D">			&#x3C;!-- Description de l'évènement ici --></span></span>
<span class="line"><span style="color:#24292E">		&#x3C;/</span><span style="color:#22863A">p</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">		&#x3C;</span><span style="color:#22863A">div</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">"mt-auto"</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">			&#x3C;</span><span style="color:#22863A">div</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">"mb-4 flex items-center justify-between"</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">				&#x3C;</span><span style="color:#22863A">span</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">"flex items-center"</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">					&#x3C;</span><span style="color:#22863A">i</span><span style="color:#6F42C1"> data-lucide</span><span style="color:#24292E">=</span><span style="color:#032F62">"map-pin"</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">"mr-1 h-4 w-4"</span><span style="color:#24292E">>&#x3C;/</span><span style="color:#22863A">i</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#6A737D">					&#x3C;!-- Nom de la ville ici --></span></span>
<span class="line"><span style="color:#24292E">				&#x3C;/</span><span style="color:#22863A">span</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">				&#x3C;</span><span style="color:#22863A">span</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">"flex items-center"</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">					&#x3C;</span><span style="color:#22863A">i</span><span style="color:#6F42C1"> data-lucide</span><span style="color:#24292E">=</span><span style="color:#032F62">"calendar"</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">"mr-1 h-4 w-4"</span><span style="color:#24292E">>&#x3C;/</span><span style="color:#22863A">i</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#6A737D">					&#x3C;!-- Date de l'évènement ici --></span></span>
<span class="line"><span style="color:#24292E">				&#x3C;/</span><span style="color:#22863A">span</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">			&#x3C;/</span><span style="color:#22863A">div</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">			&#x3C;</span><span style="color:#22863A">div</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">"flex-end flex items-center"</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">				&#x3C;</span><span style="color:#22863A">a</span></span>
<span class="line"><span style="color:#6F42C1">					class</span><span style="color:#24292E">=</span><span style="color:#032F62">"flex items-center rounded-full bg-gradient-to-r from-purple-700 to-pink-600 px-4 py-2 font-semibold text-white transition-colors duration-300 hover:from-purple-600 hover:to-pink-500"</span></span>
<span class="line"><span style="color:#6F42C1">					href</span><span style="color:#24292E">=</span><span style="color:#032F62">""</span></span>
<span class="line"><span style="color:#24292E">				></span></span>
<span class="line"><span style="color:#6A737D">					&#x3C;!-- Modifier le href ci-dessus --></span></span>
<span class="line"><span style="color:#24292E">					&#x3C;</span><span style="color:#22863A">i</span><span style="color:#6F42C1"> data-lucide</span><span style="color:#24292E">=</span><span style="color:#032F62">"ticket"</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">"mr-2 h-4 w-4"</span><span style="color:#24292E">>&#x3C;/</span><span style="color:#22863A">i</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">					Acheter une place</span></span>
<span class="line"><span style="color:#24292E">				&#x3C;/</span><span style="color:#22863A">a</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">			&#x3C;/</span><span style="color:#22863A">div</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">		&#x3C;/</span><span style="color:#22863A">div</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">	&#x3C;/</span><span style="color:#22863A">div</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">&#x3C;/</span><span style="color:#22863A">div</span><span style="color:#24292E">></span></span></code></pre><!----> <h3>Partie 2 - <em>3 points</em></h3> <p><em>N’hésitez pas à passer à l’exercice suivant si vous avez des difficultés avec cette partie</em></p> <p>Ajouter un filtre de ville pour la page <code>/evenements</code>.</p> <p>En ajoutant une query string <code>ville</code> à la route <code>/evenements</code>, la page doit afficher uniquement les événements de la ville correspondante. Par exemple, si l’url est <code>/evenements?ville=Paris</code>, la page doit afficher uniquement les événements qui ont pour ville de Paris.</p> <p>Le titre <code>title</code> de la page doit être <code>Concerts et soirées à Paris</code> si la query string <code>ville</code> est égale à <code>Paris</code>.</p> <p>Le titre <code>h2</code> de la page doit être <code>Découvrez nos événements à Paris</code> si la query string <code>ville</code> est égale à <code>Paris</code>.</p> <p>Vous pourrez utiliser la fonction <code>getEvenementsByVille</code> dans <code>models/evenements.ts</code> pour récupérer les événements par ville.</p> <h2>Exercice 3 - <em>6 points</em></h2> <p><em>Pour lancer uniquement les tests de cet exercice : <code>npm test -- exercice-3</code></em></p> <p>Nous allons maintenant ajouter la possibilité d’acheter des billets pour les événements.
La base de donnée contient une table <code>billets</code> qui contient les champs suivants :</p> <ul><li><code>id</code> : l’identifiant du billet</li> <li><code>nom</code> : le nom de la personne qui a acheté le billet</li> <li><code>prenom</code> : le prénom de la personne qui a acheté le billet</li> <li><code>evenementId</code> : l’identifiant de l’événement pour lequel le billet a été acheté</li></ul> <p>La connection à la base de donnée peut être configurée avec les options suivantes :</p> <!----><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#D73A49">const</span><span style="color:#005CC5"> db</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> await</span><span style="color:#24292E"> mysql.</span><span style="color:#6F42C1">createConnection</span><span style="color:#24292E">(&#123;</span></span>
<span class="line"><span style="color:#24292E">	host: </span><span style="color:#032F62">'127.0.0.1'</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#24292E">	user: </span><span style="color:#032F62">'root'</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#24292E">	password: </span><span style="color:#032F62">'secret'</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#24292E">	database: </span><span style="color:#032F62">'feelvibe'</span></span>
<span class="line"><span style="color:#24292E">&#125;);</span></span></code></pre><!----> <h3>Partie 1 - <em>3 points</em></h3> <p>Créer une page <code>/billets</code> qui affiche tous les les billets achetés.</p> <p>Consignes :</p> <ul><li>Créer un type <code>Billet</code> dans <code>models/billets.ts</code> qui correspond à la structure d’un billet.</li> <li>Créer une fonction de modèle <code>getBillets</code> qui va chercher dans la base de donnée les billets achetés par un utilisateur.</li> <li>Créer une vue et un controller pour la page <code>/billets</code>.</li> <li>La page doit afficher le prénom et le nom de l’utilisateur pour chaque billet.</li> <li>La page doit afficher le titre de l’événement pour chaque billet.</li></ul> <p><strong>Astuce</strong> Pour bien typer le retour de la fonction <code>execute</code>, vous pouvez utiliser la syntaxe suivante :</p> <!----><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> &#123; RowDataPacket &#125; </span><span style="color:#D73A49">from</span><span style="color:#032F62"> 'mysql2'</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#6A737D">// ...</span></span>
<span class="line"><span style="color:#D73A49">const</span><span style="color:#005CC5"> result</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> await</span><span style="color:#24292E"> db.</span><span style="color:#6F42C1">execute</span><span style="color:#24292E">&#x3C;</span><span style="color:#6F42C1">Array</span><span style="color:#24292E">&#x3C;</span><span style="color:#6F42C1">RowDataPacket</span><span style="color:#D73A49"> &#x26;</span><span style="color:#6F42C1"> Billet</span><span style="color:#24292E">>>(</span><span style="color:#D73A49">...</span><span style="color:#24292E">)</span></span></code></pre><!----> <p>Cela évitera d’avoir les erreurs de type comme au TP précédent.</p> <p><strong>Proposition de HTML pour la page</strong></p> <!----><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">&#x3C;</span><span style="color:#22863A">main</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">"flex-grow"</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">	&#x3C;</span><span style="color:#22863A">div</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">"container mx-auto px-6 py-12"</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">		&#x3C;</span><span style="color:#22863A">h2</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">"mb-8 text-center text-4xl font-bold"</span><span style="color:#24292E">>Mes billets&#x3C;/</span><span style="color:#22863A">h2</span><span style="color:#24292E">></span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">		&#x3C;</span><span style="color:#22863A">div</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">"grid grid-cols-1 gap-8 md:grid-cols-2 lg:grid-cols-3"</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#6A737D">			&#x3C;!-- Liste des billets ici --></span></span>
<span class="line"><span style="color:#24292E">		&#x3C;/</span><span style="color:#22863A">div</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">	&#x3C;/</span><span style="color:#22863A">div</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">&#x3C;/</span><span style="color:#22863A">main</span><span style="color:#24292E">></span></span></code></pre><!----> <p><strong>Proposition de HTML pour un billet (à transformer en template handlebar)</strong></p> <!----><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">&#x3C;</span><span style="color:#22863A">div</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">"flex h-full flex-col overflow-hidden rounded-xl bg-white text-purple-900 shadow-xl"</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">	&#x3C;</span><span style="color:#22863A">div</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">"flex flex-grow flex-col p-6"</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">		&#x3C;</span><span style="color:#22863A">h3</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">"mb-2 text-xl font-semibold"</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#6A737D">			&#x3C;!-- Titre de l'évènement ici --></span></span>
<span class="line"><span style="color:#24292E">		&#x3C;/</span><span style="color:#22863A">h3</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">		&#x3C;</span><span style="color:#22863A">p</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">"mb-4 flex-grow text-gray-600"</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">			Billet au nom de</span></span>
<span class="line"><span style="color:#24292E">			&#x3C;</span><span style="color:#22863A">span</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">"font-semibold"</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#6A737D">				&#x3C;!-- Nom et prénom de l'utilisateur ici --></span></span>
<span class="line"><span style="color:#24292E">			&#x3C;/</span><span style="color:#22863A">span</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">		&#x3C;/</span><span style="color:#22863A">p</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">	&#x3C;/</span><span style="color:#22863A">div</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">&#x3C;/</span><span style="color:#22863A">div</span><span style="color:#24292E">></span></span></code></pre><!----> <h3>Partie 2 - <em>3 points</em></h3> <p>Créer une page <code>/evenements/&lt;id>/acheter-billet</code> qui permet d’acheter un billet pour un événement.</p> <p>Consignes :</p> <ul><li><p>Créer une route, une vue et un controller pour la page <code>/evenements/&lt;id>/acheter-billet</code> qui contient le formulaire pour acheter un billet.</p></li> <li><p>Le formulaire doit contenir les champs <code>nom</code> et <code>prenom</code>.</p></li> <li><p>La page doit afficher le titre de l’événement pour lequel on achète un billet.</p></li> <li><p>Créer une fonction de modèle <code>acheterBillet</code> qui va ajouter un billet dans la base de donnée.</p></li> <li><p>Rediriger l’utilisateur vers la page <code>/billets</code> après qu’il ait soumis le formulaire avec la method <code>res.redirect('/billets')</code>.</p> <p><strong>Astuce</strong> Pour récupérer l’id de l’événement depuis la route, vous pouvez utiliser <code>req.params.id</code> dans le controller.</p></li></ul> <!----><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">app.</span><span style="color:#6F42C1">get</span><span style="color:#24292E">(</span><span style="color:#032F62">'/evenements/:id/acheter-billet'</span><span style="color:#24292E">, (</span><span style="color:#E36209">req</span><span style="color:#24292E">, </span><span style="color:#E36209">res</span><span style="color:#24292E">) </span><span style="color:#D73A49">=></span><span style="color:#24292E"> &#123;</span></span>
<span class="line"><span style="color:#D73A49">	const</span><span style="color:#005CC5"> id</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> req.params.id; </span><span style="color:#6A737D">// vaut 12 si l'url est /evenements/12/acheter-billet</span></span>
<span class="line"><span style="color:#24292E">&#125;);</span></span></code></pre><!----> <p><strong>Astuce</strong> Vous pouvez utiliser la fonction <code>getEvenementById</code> dans <code>models/evenements.ts</code> pour récupérer l’événement par son id. Vous pouvez utiliser <code>Number.parseInt</code> pour convertir l’id en nombre.</p> <p><strong>Astuce</strong> Pour bien typer le retour de la fonction <code>execute</code>, vous pouvez utiliser la syntaxe suivante :</p> <!----><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> &#123; ResultSetHeader &#125; </span><span style="color:#D73A49">from</span><span style="color:#032F62"> 'mysql2'</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#6A737D">// ...</span></span>
<span class="line"><span style="color:#D73A49">const</span><span style="color:#005CC5"> result</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> await</span><span style="color:#24292E"> db.</span><span style="color:#6F42C1">execute</span><span style="color:#24292E">&#x3C;</span><span style="color:#6F42C1">ResultSetHeader</span><span style="color:#24292E">>(</span><span style="color:#D73A49">...</span><span style="color:#24292E">);</span></span></code></pre><!----> <p>Cela évitera d’avoir les erreurs de type comme au TP précédent.</p> <p><strong>Proposition de HTML pour le formulaire</strong></p> <!----><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">&#x3C;</span><span style="color:#22863A">main</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">"flex-grow"</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">	&#x3C;</span><span style="color:#22863A">div</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">"container mx-auto px-6 py-12"</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">		&#x3C;</span><span style="color:#22863A">div</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">"mx-auto max-w-2xl overflow-hidden rounded-xl bg-white text-purple-900 shadow-2xl"</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">			&#x3C;</span><span style="color:#22863A">div</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">"p-8"</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">				&#x3C;</span><span style="color:#22863A">h2</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">"mb-6 text-3xl font-bold"</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#6A737D">					&#x3C;!-- titre de l'évènement --></span></span>
<span class="line"><span style="color:#24292E">				&#x3C;/</span><span style="color:#22863A">h2</span><span style="color:#24292E">></span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">				&#x3C;</span><span style="color:#22863A">form</span><span style="color:#6F42C1"> id</span><span style="color:#24292E">=</span><span style="color:#032F62">"ticket-form"</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">"space-y-6"</span><span style="color:#6F42C1"> method</span><span style="color:#24292E">=</span><span style="color:#032F62">"POST"</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">					&#x3C;</span><span style="color:#22863A">div</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">						&#x3C;</span><span style="color:#22863A">label</span><span style="color:#6F42C1"> for</span><span style="color:#24292E">=</span><span style="color:#032F62">"nom"</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">"mb-1 block text-sm font-medium text-gray-700"</span><span style="color:#24292E">>Nom&#x3C;/</span><span style="color:#22863A">label</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">						&#x3C;</span><span style="color:#22863A">input</span></span>
<span class="line"><span style="color:#6F42C1">							type</span><span style="color:#24292E">=</span><span style="color:#032F62">"text"</span></span>
<span class="line"><span style="color:#6F42C1">							id</span><span style="color:#24292E">=</span><span style="color:#032F62">"nom"</span></span>
<span class="line"><span style="color:#6F42C1">							name</span><span style="color:#24292E">=</span><span style="color:#032F62">"nom"</span></span>
<span class="line"><span style="color:#6F42C1">							required</span></span>
<span class="line"><span style="color:#6F42C1">							class</span><span style="color:#24292E">=</span><span style="color:#032F62">"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-purple-500 focus:outline-none focus:ring-2 focus:ring-purple-500"</span></span>
<span class="line"><span style="color:#24292E">						/></span></span>
<span class="line"><span style="color:#24292E">					&#x3C;/</span><span style="color:#22863A">div</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">					&#x3C;</span><span style="color:#22863A">div</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">						&#x3C;</span><span style="color:#22863A">label</span><span style="color:#6F42C1"> for</span><span style="color:#24292E">=</span><span style="color:#032F62">"prenom"</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">"mb-1 block text-sm font-medium text-gray-700"</span><span style="color:#24292E">>Prénom&#x3C;/</span><span style="color:#22863A">label</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">						&#x3C;</span><span style="color:#22863A">input</span></span>
<span class="line"><span style="color:#6F42C1">							type</span><span style="color:#24292E">=</span><span style="color:#032F62">"text"</span></span>
<span class="line"><span style="color:#6F42C1">							id</span><span style="color:#24292E">=</span><span style="color:#032F62">"prenom"</span></span>
<span class="line"><span style="color:#6F42C1">							name</span><span style="color:#24292E">=</span><span style="color:#032F62">"prenom"</span></span>
<span class="line"><span style="color:#6F42C1">							required</span></span>
<span class="line"><span style="color:#6F42C1">							class</span><span style="color:#24292E">=</span><span style="color:#032F62">"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-purple-500 focus:outline-none focus:ring-2 focus:ring-purple-500"</span></span>
<span class="line"><span style="color:#24292E">						/></span></span>
<span class="line"><span style="color:#24292E">					&#x3C;/</span><span style="color:#22863A">div</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">					&#x3C;</span><span style="color:#22863A">div</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">						&#x3C;</span><span style="color:#22863A">button</span></span>
<span class="line"><span style="color:#6F42C1">							type</span><span style="color:#24292E">=</span><span style="color:#032F62">"submit"</span></span>
<span class="line"><span style="color:#6F42C1">							class</span><span style="color:#24292E">=</span><span style="color:#032F62">"flex w-full items-center justify-center rounded-full bg-gradient-to-r from-purple-700 to-pink-600 px-6 py-3 font-semibold text-white transition-colors duration-300 hover:from-purple-600 hover:to-pink-500"</span></span>
<span class="line"><span style="color:#24292E">						></span></span>
<span class="line"><span style="color:#24292E">							&#x3C;</span><span style="color:#22863A">i</span><span style="color:#6F42C1"> data-lucide</span><span style="color:#24292E">=</span><span style="color:#032F62">"ticket"</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">"mr-2 h-5 w-5"</span><span style="color:#24292E">>&#x3C;/</span><span style="color:#22863A">i</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">							Acheter le billet</span></span>
<span class="line"><span style="color:#24292E">						&#x3C;/</span><span style="color:#22863A">button</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">					&#x3C;/</span><span style="color:#22863A">div</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">				&#x3C;/</span><span style="color:#22863A">form</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">			&#x3C;/</span><span style="color:#22863A">div</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">		&#x3C;/</span><span style="color:#22863A">div</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">	&#x3C;/</span><span style="color:#22863A">div</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">&#x3C;/</span><span style="color:#22863A">main</span><span style="color:#24292E">></span></span></code></pre><!----><!----><!--]--><!----></main></div><!----><!--]--><!----></div><!----><!--]--> <!--[!--><!--]--><!--]-->
			
			<script>
				{
					__sveltekit_pqo0dy = {
						base: new URL("../../../..", location).pathname.slice(0, -1)
					};

					const element = document.currentScript.parentElement;

					Promise.all([
						import("../../../../_app/immutable/entry/start.Bnp5303b.js"),
						import("../../../../_app/immutable/entry/app.gFT0rYy9.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 2, 21],
							data: [{"type":"data","data":null,"uses":{}},null,null],
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
	</body>
</html>
