<!doctype html>
<html lang="fr">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="../../../favicon.png" />

		<meta name="viewport" content="width=device-width" />
		
		<link href="../../../_app/immutable/assets/0.DeOizrWX.css" rel="stylesheet">
		<link href="../../../_app/immutable/assets/2.Dz1qT87F.css" rel="stylesheet">
		<link href="../../../_app/immutable/assets/Reveal.BYkb6MAx.css" rel="stylesheet">
		<link rel="modulepreload" href="../../../_app/immutable/entry/start.Bnp5303b.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/Cugo8Sw9.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/_Roc1N7j.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/Du4uIILg.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/DYGiXs1v.js">
		<link rel="modulepreload" href="../../../_app/immutable/entry/app.gFT0rYy9.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/jKjWACjA.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/CozvbqRy.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/CU3E0FLs.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/B4pklceG.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/pFiT_qqh.js">
		<link rel="modulepreload" href="../../../_app/immutable/nodes/0.BjDQT2Bq.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/CMei0t4b.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/Bgovi1YL.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/D4AmcDfz.js">
		<link rel="modulepreload" href="../../../_app/immutable/nodes/2.CBLjlu0K.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/B0BGekoV.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/BMkXc6el.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/Cv3pZryr.js">
		<link rel="modulepreload" href="../../../_app/immutable/nodes/20.DmNeA1EI.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/Cs1o_ong.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/DyuDGlf2.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/OjqImkSQ.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/Dayddfh2.js"><!--[--><!--]--><!--[--><!--]--><!--[--><!--]--><title>API REST - Johan Girod</title>
	</head>
	<body data-sveltekit-preload-data="hover">
		<div style="display: contents"><!--[--><!--[--><!----><div class="screen:container prose-h2 container prose prose-slate mx-auto my-12 px-4 lg:prose-xl prose-headings:text-slate-800 prose-h1:font-semibold prose-a:transition prose-a:duration-75 hover:prose-a:text-pink-500 lg:px-0 print:mx-0 print:max-w-none"><!----><!--[--><!----><div class="lg:prose-lg"><div style="view-transition-name: breadcrumb"><div class="mb-2 inline" role="list"><!--[--><li class="inline-block"><a href="/" class="text-pink-600" aria-label="Accueil">Accueil</a> <!--[--><span class="mx-2 text-gray-500">/</span><!--]--></li><li class="inline-block"><a href="/cours/" class="text-pink-600" aria-label="Cours et TP">Cours et TP</a> <!--[--><span class="mx-2 text-gray-500">/</span><!--]--></li><li class="inline-block"><a href="http://sveltekit-prerender/cours/tw3/5-api-rest/" class="text-pink-600" aria-label="...">...</a> <!--[!--><!--]--></li><!--]--></div><!----> <!--[--><span class="ml-2 inline-block rounded-full bg-pink-500 px-2 py-1 text-sm font-semibold text-white">Avec corrigé</span><!--]--></div> <main class="mt-8 prose-h1:inline-block prose-h1:border-y-8 prose-h1:border-pink-500 prose-h1:px-2 prose-h1:pb-3 prose-h1:pt-2 prose-h1:text-4xl prose-h2:text-3xl"><!----><!--[!--><!----><h1>API REST</h1> <p>Ce TP vous permettra de créer une filmothèque pour rechercher les films que nous avons vus, et leur donner une note (un peu comme sur le site <a href="https://www.senscritique.com" rel="nofollow">sens-critique</a>).</p> <p>Cette application sera sous forme d’une page web dynamique échangeant avec le serveur via une API REST.</p> <h2>Objectifs d’apprentissage</h2> <ul><li>Savoir ce qu’est une API REST et la différence avec une architecture MVC</li> <li>Créer une API REST avec express</li> <li>Utiliser <code>fetch</code> pour appeler une API REST depuis le navigateur</li> <li>Utiliser JavaScript pour créer une page dynamique</li></ul> <h2>Sommaire</h2> <ul><li><a href="#architecture">Présentation de l’architecture</a></li> <li><a href="#start">Préparatifs</a></li> <li><a href="#exercice-1">Exercice 1 : afficher la liste des films</a></li> <li><a href="#exercice-2">Exercice 2 : rechercher des films</a></li> <li><a href="#exercice-3">Exercice 3 : récupérer les films de la bibliothèque</a></li> <li><a href="#exercice-4">Exercice 4 : marquer un film comme vu / non vu</a></li> <li><a href="#exercice-5">Exercice 5 : ajouter une note à un film</a></li></ul> <span id="architecture"></span> <h2>Présentation de l’architecture</h2> <p>Nous utiliserons pour ce TP une architecture client / serveur avec une communication via une <strong>API REST</strong>.</p> <div class="bg-blue-100 border-l-4 border-blue-500 px-4 py-2"><p class="font-bold text-blue-700"><!----><div slot="title">Qu'est-ce qu'une API ?</div><!----></p> <!----><p>Une <strong>API</strong> (Application Programming Interface, interface de programmation applicative en français) est un <strong>ensemble de définitions</strong> et de protocoles permettant à un <strong>programme d’interagir avec un autre programme</strong>, en cachant les détails de l’implémentation.</p> <p>Il s’agit donc d’une interface offerte par un programme informatique, une bibliothèque logicielle, un service ou encore un système d’exploitation.</p> <p>Par exemple, un <strong>navigateur web</strong> expose des <strong>APIs JavaScript</strong> permettant de manipuler le DOM, de faire des requêtes HTTP, de gérer les cookies, etc.
Ainsi, la fonction <code>getElementById</code> est définie par l’API JavaScript du navigateur.</p> <p><a href="https://developer.mozilla.org/fr/docs/Learn/JavaScript/Client-side_web_APIs/Introduction" rel="nofollow">En savoir plus sur les APIs dans le web</a></p><!----></div><!----> <p> </p> <div class="bg-blue-100 border-l-4 border-blue-500 px-4 py-2"><p class="font-bold text-blue-700"><!----><div slot="title">Qu'est-ce qu'une API REST ?</div><!----></p> <!----><p>Dans une <strong>API REST</strong>, l’interface consiste en un ensemble d’<strong>URLs</strong> et de <strong>verbes HTTP</strong> (GET, POST, PUT, DELETE) permettant d’interagir avec le serveur. En retour, le serveur renvoie des données au <strong>format JSON</strong>.</p> <img src="/images/rest-api.png" alt="What is a REST API ?" style="width: 100%"> <p>Plus précisément, dans une API REST, <strong>chaque URL correspond à une ressource</strong> (un objet manipulé par l’API). Les verbes HTTP permettent au client de préciser l’action à effectuer sur la ressource.</p> <p>Par exemple, pour une ressource <code>movie</code>, on pourrait avoir les routes suivantes :</p> <ul><li><code>GET /movies</code> : récupérer la liste des films</li> <li><code>GET /movies/1</code> : récupérer le film avec l’identifiant 1</li> <li><code>POST /movies</code> : ajouter un nouveau film</li> <li><code>PUT /movies/1</code> : modifier le film avec l’identifiant 1</li></ul> <p>En retour, le serveur renvoie des données au format JSON, avec un code HTTP indiquant si la requête a réussi ou non. Par exemple, pour la requête <code>GET /movies/1</code>, le serveur pourrait renvoyer :</p> <!----><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">&#123;</span></span>
<span class="line"><span style="color:#005CC5">	"id"</span><span style="color:#24292E">: </span><span style="color:#005CC5">1</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#005CC5">	"title"</span><span style="color:#24292E">: </span><span style="color:#032F62">"The Matrix"</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#005CC5">	"year"</span><span style="color:#24292E">: </span><span style="color:#005CC5">1999</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#005CC5">	"summary"</span><span style="color:#24292E">: </span><span style="color:#032F62">"A computer hacker learns from mysterious rebels about the true nature of his reality and his role in the war against its controllers."</span></span>
<span class="line"><span style="color:#24292E">&#125;</span></span></code></pre><!----> <p>Ou encore, si le film n’existe pas, le serveur renverra un code HTTP 404 (Not Found).</p> <p><strong>Les APIs REST sont donc construites avec les briques de bases du protocole HTTP</strong> (URLs, verbes HTTP, codes HTTP).</p> <p><a href="https://www.redhat.com/fr/topics/api/what-is-a-rest-api" rel="nofollow">En savoir plus sur les API REST</a></p><!----></div><!----> <p> </p> <div class="bg-blue-100 border-l-4 border-blue-500 px-4 py-2"><p class="font-bold text-blue-700"><!----><div slot="title">Le format JSON</div><!----></p> <!----><p>Le <strong>JSON</strong> (JavaScript Object Notation) est un format de données qui permet de représenter des objets sous forme de chaînes de caractères. Il possède une syntaxe similaire à celle des objets JavaScript, à ceci près que les clés doivent être entourées de guillemets doubles.</p><!----></div><!----> <p>Ainsi, dans ce type d’architecture, contrairement à une architecture MVC, le serveur ne s’occupe pas de générer les vues (HTML).</p> <p>Il ne transmet que des données au format JSON. C’est le client (navigateur) qui se charge de générer les vues pour les afficher à l’utilisateur.</p> <span id="start"></span> <h2>Préparatifs : installer et lancer le projet</h2> <p>Nous utiliserons l’environnement de développement sur les machines de l’école.</p> <h3>Clonage du projet</h3> <p>Le code se trouve sur Github. Pour installer le projet, lancer les commandes suivantes dans un terminal:</p> <!----><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D"># Clone le projet git dans le dossier courant</span></span>
<span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> clone</span><span style="color:#032F62"> https://github.com/johangirod/TP-REST</span></span>
<span class="line"><span style="color:#005CC5">cd</span><span style="color:#032F62"> TP-REST</span></span>
<span class="line"><span style="color:#6F42C1">npm</span><span style="color:#032F62"> install</span></span></code></pre><!----> <h3>Installer les extensions vscode</h3> <p>Ouvrez l’éditeur vscode avec la commande suivante :</p> <!----><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">code</span><span style="color:#032F62"> .</span><span style="color:#24292E"> &#x26;</span></span></code></pre><!----> <p>Ouvrez le menu des extensions (<code>Ctrl+Maj+X</code>) et cherchez “@recommended”. Vous devriez voir apparaître les extensions suivantes :</p> <ul><li>Thunder Client</li> <li>ESLint</li> <li>Prettier - Code formatter</li></ul> <p>Installer ces trois extensions.</p> <h3>Présentation du projet</h3> <p>Le code source du serveur se trouve dans le dossier <code>server</code>, celui du javascript executé sur le navigateur se trouve dans le dossier <code>public</code>, dans le fichier <code>app.js</code>.</p> <h3>Lancer le projet</h3> <p>Pour lancer le serveur, lancer la commande suivante :</p> <!----><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">npm</span><span style="color:#032F62"> run</span><span style="color:#032F62"> dev</span></span></code></pre><!----> <p>Vérifiez que le serveur est bien lancé en allant sur <code>http://localhost:3000</code>.</p> <p><strong>Note</strong> il est conseillé de laisser les logs toujours ouverts quand vous développez, vous verrez directement les messages d’erreur s’il y en a.</p> <span id="exercice-1"></span> <h2>Exercice 1 : afficher la liste des films</h2> <p>Le but de cet exercice est d’afficher la liste des films sur la page d’accueil.</p> <h3>Créer une route sur le serveur</h3> <p>Pour cela, nous allons créer une nouvelle route <code>/movies</code> sur le serveur qui renverra la liste des films au format JSON.</p> <p>Dans le fichier <code>server/routes/movies.ts</code>, créer une route <code>GET /movies</code> qui renvoie la liste des films au format JSON.</p> <ul><li><p>Pour manipuler les films, vous utiliserez les fonctions exportées par le fichier <code>server/models/movies.ts</code>.</p></li> <li><p>Pour envoyer une réponse au format json, vous pouvez utiliser la fonction <a href="https://expressjs.com/en/5x/api.html#res.json" rel="nofollow"><code>res.json()</code></a> de express.</p></li></ul> <h3>Testez votre route avec Thunder Client</h3> <p>Pour tester votre route, vous pouvez utiliser l’extension Thunder Client directement dans vscode.</p> <ul><li><p>Ouvrez Thunder Client avec la commande <code>Ctrl+Maj+P</code> puis en tapant “Thunder Client: New request”.</p></li> <li><p>Dans la fenêtre qui s’ouvre, sélectionnez “GET” dans le menu déroulant, puis entrez l’URL de votre route : <code>http://localhost:3000/movies</code>.</p></li> <li><p>Cliquez sur le bouton “Send” pour envoyer la requête.</p></li> <li><p>Vous devriez voir apparaître la liste des films dans la réponse du serveur.</p></li></ul> <!--[!--><!--]--><!----> <h3>Afficher la liste des films sur la page d’accueil</h3> <p>Maintenant que nous avons une route qui renvoie la liste des films, nous allons afficher cette liste sur la page d’accueil, en modifiant le fichier <code>public/app.js</code>.</p> <p>Pour récuperer les données du serveur, nous allons utiliser la fonction <a href="https://developer.mozilla.org/fr/docs/Web/API/Fetch_API/Using_Fetch" rel="nofollow"><code>fetch</code></a> en JavaScript.</p> <p>Pour afficher les films, vous pourrez utiliser la fonction <code>createMovieCard</code> du fichier <code>client/movie-card.js</code>.</p> <p>Cette fonction prend en paramètre un objet contenant la propriété <code>movie</code> du même type que celui retourné par la route <code>/movies</code>.</p> <ol><li>Créer une la fonction <code>async function getMovies</code> qui retourne la liste des films récupérée depuis le serveur avec la fonction <code>fetch</code>. <!----><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#D73A49">const</span><span style="color:#005CC5"> response</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> await</span><span style="color:#6F42C1"> fetch</span><span style="color:#24292E">(</span><span style="color:#032F62">&#96;/movies&#96;</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#D73A49">const</span><span style="color:#005CC5"> movies</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> await</span><span style="color:#24292E"> response.</span><span style="color:#6F42C1">json</span><span style="color:#24292E">();</span></span></code></pre><!----></li> <li>Créer une fonction <code>renderMovies</code> qui prend en paramètre la liste des films et qui affiche les films sur la page d’accueil en utilisant la fonction <code>createMovieCard</code>. <ol><li>Récupérer le container HTML qui contiendra les films avec la fonction <a href="https://developer.mozilla.org/fr/docs/Web/API/Document/querySelector" rel="nofollow"><code>document.querySelector</code></a>.</li> <li>Supprimer son contenu avec la propriété <a href="https://developer.mozilla.org/fr/docs/Web/API/Element/innerHTML" rel="nofollow"><code>innerHTML</code></a>.</li> <li>Parcourir la liste des films et pour chacun d’entre eux, créer un élément HTML avec la fonction <code>createMovieCard</code> et l’ajouter au container avec la fonction <a href="https://developer.mozilla.org/fr/docs/Web/API/Node/appendChild" rel="nofollow"><code>appendChild</code></a>.</li></ol></li> <li>Dans la fonction <code>main</code>, appeler la fonction <code>getMovies</code> pour récupérer la liste des films, puis appeler la fonction <code>renderMovies</code> pour afficher les films sur la page d’accueil.</li></ol> <!--[!--><!--]--><!----> <span id="exercice-2"></span> <h2>Exercice 2 : rechercher des films</h2> <p>Nous allons maintenant ajouter la possibilité de rechercher des films par titre grâce au champs de recherche.</p> <ol><li><p>Modifier la route <code>/movies</code> côté serveur pour qu’elle prenne en paramètre un querystring <code>query</code> et le passe à la fonction <code>getMovies</code>. Vous pouvez tester votre route avec l’extension Thunder Client.</p></li> <li><p>Modifier la fonction <code>getMovies</code> côté client pour qu’elle prenne en paramètre une chaîne de caractère <code>query</code> et qu’elle l’envoie au serveur dans la requête <code>fetch</code>.</p></li> <li><p>Brancher le champs de recherche sur la fonction <code>getMovies</code> pour qu’elle soit appelée à chaque fois que l’utilisateur tape une lettre dans le champs de recherche.</p> <ul><li>Dans la fonction <code>main</code>, récuperer l’élement HTML du champs de recherche avec la fonction <a href="https://developer.mozilla.org/fr/docs/Web/API/Document/querySelector" rel="nofollow"><code>document.querySelector([data-search-input])</code></a>.</li> <li>Écoutez les événements <code>input</code> sur le champs de recherche avec la fonction <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/input_event" rel="nofollow"><code>addEventListener</code></a>. Cet événement est déclenché à chaque fois que l’utilisateur tape une lettre dans le champs de recherche.</li> <li>A chaque fois que l’événement est déclenché, appeler la fonction <code>getMovies</code> avec la valeur du champs de recherche en paramètre pour récupérer la liste des films correspondant à la recherche, puis appeler la fonction <code>renderMovies</code> pour actualiser l’affichage.</li></ul></li> <li><p>Vérifier que la recherche fonctionne en testant votre application</p></li></ol> <!--[!--><!--]--><!----> <span id="exercice-3"></span> <h2>Exercice 3 : récupérer les films de la bibliothèque</h2> <p>Dans cet exercice, nous allons différencier les films qui sont déjà dans la bibliothèque de l’utilisateur de ceux qui ne le sont pas. Nous allons également afficher la note que l’utilisateur a donné à chaque film.</p> <h3>Côté serveur</h3> <p>Nous allons créer une ressource <code>library</code> qui contenant les films de la bibliothèque de l’utilisateur et la note donnée. Son type est le suivant :</p> <!----><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#D73A49">type</span><span style="color:#6F42C1"> LibraryMovie</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> &#123;</span></span>
<span class="line"><span style="color:#E36209">	movieId</span><span style="color:#D73A49">:</span><span style="color:#005CC5"> string</span><span style="color:#24292E">; </span><span style="color:#6A737D">// l'identifiant du film</span></span>
<span class="line"><span style="color:#E36209">	rating</span><span style="color:#D73A49">?:</span><span style="color:#005CC5"> number</span><span style="color:#24292E">; </span><span style="color:#6A737D">// la note donnée par l'utilisateur (optionnelle)</span></span>
<span class="line"><span style="color:#24292E">&#125;;</span></span></code></pre><!----> <p>Pour exposer cette ressource avec l’API, nous allons créer une route <code>GET /library/:movieId</code> qui renvoie la ressource si le film avec l’identifiant <code>movieId</code> est dans la bibliothèque de l’utilisateur, et une erreur 404 sinon.</p> <ol><li>Créer une nouvelle route <code>GET</code> dans le fichier <code>server/routes/library.ts</code>.</li> <li>Récupérer l’identifiant du film dans les paramètres de la route avec <code>req.params.movieId</code>.</li> <li>Récupérer le film dans la bibliothèque de l’utilisateur avec la fonction <code>getLibraryMovieById</code> du fichier <code>server/models/library.ts</code>. Cette fonction renvoie une erreur <code>NotFoundError</code> si le film n’est pas dans la bibliothèque de l’utilisateur.</li> <li>Renvoyer les informations du film de la bibliothèque si il est présent. Sinon retourner une erreur 404 avec la fonction <a href="https://expressjs.com/en/5x/api.html#res.status" rel="nofollow"><code>res.status(404).send()</code></a>.</li> <li>Tester votre route avec l’extension Thunder Client.</li></ol> <!--[!--><!--]--><!----> <h3>Côté client</h3> <p>Pour chaque objet <code>movie</code> affiché, nous allons faire un appel à la route <code>/library/:movieId</code> pour vérifier si le film est dans la bibliothéque. Puis, il faudra modifier l’objet <code>movie</code> pour ajouter deux nouvelles propriétés :</p> <ul><li><code>isInLibrary</code> : un booléen indiquant si le film est dans la bibliothèque de l’utilisateur</li> <li><code>rating</code> : la note donnée par l’utilisateur au film (si elle existe)</li></ul> <ol><li><p>Créer une fonction <code>aync function getLibraryMovie(movieId)</code> qui vérifie si le film est dans la bibliothèque de l’utilisateur en appelant la route <code>GET /library/:movieId</code> du serveur. Cette fonction renvoie <code>false</code> si le film n’est pas dans la bibliothèque de l’utilisateur (le seveur renvoie 404), et l’objet renvoyé par le serveur si il est présent (contenant les propriétés <code>rating</code> et <code>movieId</code>).</p></li> <li><p>Modifier la fonction <code>async function getMovies</code> pour ajouter les propriété de la bibliothèque à chaque film de la liste avant de la retourner. Pour modifier la liste, vous pouvez utiliser au choix :</p> <ul><li>une boucle for : <code>for (const movie of movies) { ... }</code> (méthode impérative)</li> <li>la fonction <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/Array/map" rel="nofollow"><code>map</code></a> : <code>movies.map(movie => { ... })</code> et <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/Promise/all" rel="nofollow"><code>Promise.all</code></a> pour attendre la fin de toutes les requêtes (méthode fonctionnelle)</li></ul></li> <li><p>Vérifier que cela fonctionne en rafrachissant l’application. Vous devriez voir apparaître des notes sur certains films.</p></li></ol> <!--[!--><!--]--><!----> <span id="exercice-4"></span> <h2>Exercice 4 : marquer un film comme vu ou non vu</h2> <p>Maintenant nous allons permettre à l’utilisateur de modifier la liste des films de sa bibliothèque, en ajoutant ou en supprimant des films.</p> <p>Cela, grâce à deux nouvelles routes à la ressource <code>library</code> qui vont faire leur apparition :</p> <ul><li><code>POST /library</code> pour ajouter un film à la bibliothèque de l’utilisateur</li> <li><code>DELETE /library/:movieId</code> pour supprimer un film de la bibliothèque de l’utilisateur</li></ul> <h3>Côté serveur</h3> <ol><li><p>Créer une route <code>POST /library</code> dans le fichier <code>server/routes/library.ts</code></p> <ul><li>Cette route paramètre un objet <code>LibraryMovie</code> présent dans le corps de la requête</li> <li>Elle appelle la fonction <code>addMovieToLibrary</code> du fichier <code>server/models/library.ts</code> pour ajouter le film à la bibliothèque de l’utilisateur. Cette fonction renvoie une erreur <code>BadRequestError</code> si le film est déjà dans la bibliothèque de l’utilisateur.</li> <li>Si le film est déjà dans la bibliothèque de l’utilisateur, la route renvoie un code d’erreur 400 (Bad Request) avec le message d’erreur. Sinon, elle retourne l’objet ajouté.</li> <li>Tester votre route avec l’extension Thunder Client.</li></ul></li> <li><p>Créer une route <code>DELETE /library/:movieId</code> dans le fichier <code>server/routes/library.ts</code> qui renvoie une 404 si le film n’est pas dans la bibliothèque. Tester votre route avec l’extension Thunder Client.</p></li></ol> <!--[!--><!--]--><!----> <h3>Coté client</h3> <h4>Ajout d’un film à la bibliothèque</h4> <p>Créer une fonction <code>async function addMovieToLibrary(movieId)</code> qui appelle la route <code>POST /library</code> avec dans le corps de la requête l’identifiant du film à ajouter au format JSON. Ces informations seront spécifiées dans le second paramètre de la fonction <a href="https://developer.mozilla.org/fr/docs/Web/API/Fetch_API/Using_Fetch" rel="nofollow"><code>fetch</code></a>.</p> <ul><li><code>method</code> : la méthode HTTP à utiliser (ici <code>POST</code>)</li> <li><code>headers</code> : les headers de la requête (ici <code>{ "Content-Type": "application/json" " }</code>)</li> <li><code>body</code> : le corps de la requête (l’identifiant du film au format JSON)</li></ul> <p>Passer cette fonction en tant que callback dans les arguments de la fonction <code>createMovieCard</code> : <code>createMovieCard({ movie, onAddToLibrary: addMovieToLibrary })</code>.</p> <p>Le callback <code>onAddToLibrary</code> est appelé lorsque l’utilisateur clique sur le bouton “Ajouter”. Il prend en paramètre l’identifiant du film à ajouter.</p> <h4>Suppression d’un film de la bibliothèque</h4> <p>Créer une fonction <code>async function removeFromLibrary(movieId)</code> qui appelle la route <code>DELETE /library/:movieId</code> avec dans le corps de la requête l’identifiant du film à supprimer au format JSON. De même, reliez cette fonction au bouton “Enlever” avec le paramètre callback <code>onRemoveFromLibrary</code> de la fonction <code>createMovieCard</code>.</p> <p>Testez votre application en ajoutant et en supprimant des films de la bibliothèque et en rafraichissant la page pour vérifier que les modifications sont bien sauvegardées.</p> <!--[!--><!--]--><!----> <span id="exercice-5"></span> <h2>Exercice 5 : ajouter une note à un film</h2> <p>Dernière étape, nous allons permettre à l’utilisateur de modifier les notes des films de sa bibliothèque.</p> <p>Pour modifier une ressource, c’est le verbe HTTP <code>PUT</code> qui est utilisé.</p> <h3>Côté serveur</h3> <p>Créez une route <code>PUT /library/:movieId</code> dans le fichier <code>server/routes/library.ts</code> qui prend en paramètre l’identifiant du film et la nouvelle note à lui attribuer dans le corps de la requête. Vous utiliserez la fonction <code>modifyLibraryMovie</code> du fichier <code>server/models/library.ts</code> pour modifier la note du film. Cette fonction renvoie une erreur <code>NotFoundError</code> si le film n’est pas dans la bibliothèque de l’utilisateur.</p> <p>Tester votre route avec l’extension Thunder Client.</p> <h3>Côté client</h3> <p>Utiliser le callback <code>updateRating</code> passé en paramètre de la fonction <code>createMovieCard</code>. Ce callback est appelé lorsque l’utilisateur modifie la note d’un film. Il prend en premier paramètre l’identifiant du film et en second paramètre la note donnée.</p> <!--[!--><!--]--><!----> <div class="prose-code:radius-none prose-code:font-mono prose-code:font- mt-14 prose-h1:text-5xl prose-h2:text-3xl prose-h2:text-pink-500 prose-p:text-2xl prose-blockquote:text-2xl prose-blockquote:font-normal prose-blockquote:text-pink-500 prose-code:w-auto prose-code:rounded prose-pre:bg-slate-100 prose-pre:text-left prose-pre:text-xl prose-li:text-left prose-li:text-2xl md:-ml-14 md:-mr-14"><div class="reveal rounded-md border border-gray-200 shadow-lg svelte-1xe5mne"><!--[--><div class="absolute z-50 flex h-full w-full items-center justify-center bg-white"><div class="absolute z-50 flex h-full w-full items-center justify-center bg-white"><div class="h-32 w-32 animate-spin"><svg class="h-full w-full text-pink-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0
                                3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg></div></div></div><!--]--> <div class="slides"><!----><section><h1>API REST : à retenir</h1> <h2 class="text-pink-500">Technologie web 3</h2> <p class="text-gray-500">Johan Girod</p></section> <section><section><h2>Une API REST</h2> <ul><li class="fragment">Utilise `JSON` comme format d'échange de document</li> <li class="fragment">Est basée sur le protocole HTTP (GET / PUT / DELETE / POST)</li> <li class="fragment">Associe des `ressources` à des URLs</li></ul></section> <section data-auto-animate=""><h2>Quels avantages ?</h2> <p class="text-gray-500">À votre avis</p></section> <section data-auto-animate=""><h2>Quels avantages ?</h2> <ul><li class="fragment">Permet de créer des pages webs <strong>dynamiques</strong> (sans rechargement de page)</li> <li class="fragment">Utilisable par <strong>d'autres clients</strong> que des navigateurs (application mobiles, serveur,
				...)</li> <li class="fragment"><strong>Découple clairement</strong> la logique métier de la logique d'affichage</li></ul></section> <section><h2>Quels inconvénients ?</h2> <ul><li class="fragment">Plus compliqué à développer</li> <li class="fragment">Moins <strong>performantes</strong> pour l'utilisateur</li> <li class="fragment">Moins «standards »</li></ul></section></section><!----></div></div></div><!----> <h2>Bonus</h2> <ul><li>Séparer les films de la filmotheque dans une section à part</li></ul> <h2>Questions de fin</h2> <ul><li>Quels sont les avantages d’une API REST par rapport à une architecture MVC ?</li> <li>Quels sont les inconvénients d’une API REST par rapport à une architecture MVC ?</li> <li>Nous souhaitons ajouter la possibilité à l’administrateur de l’application d’ajouter des films à la base de donnée. Quelle route devons-nous créer ? Quel verbe HTTP utiliser ?</li> <li>Et pour modifier un film présent ? —></li></ul><!----><!--]--><!----></main></div><!----><!--]--><!----></div><!----><!--]--> <!--[!--><!--]--><!--]-->
			
			<script>
				{
					__sveltekit_pqo0dy = {
						base: new URL("../../..", location).pathname.slice(0, -1)
					};

					const element = document.currentScript.parentElement;

					Promise.all([
						import("../../../_app/immutable/entry/start.Bnp5303b.js"),
						import("../../../_app/immutable/entry/app.gFT0rYy9.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 2, 20],
							data: [{"type":"data","data":null,"uses":{}},null,null],
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
	</body>
</html>
