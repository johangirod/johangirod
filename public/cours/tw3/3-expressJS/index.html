<!doctype html>
<html lang="fr">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="../../../favicon.png" />

		<meta name="viewport" content="width=device-width" />
		
		<link href="../../../_app/immutable/assets/0.DeOizrWX.css" rel="stylesheet">
		<link href="../../../_app/immutable/assets/2.Dz1qT87F.css" rel="stylesheet">
		<link href="../../../_app/immutable/assets/Reveal.BYkb6MAx.css" rel="stylesheet">
		<link rel="modulepreload" href="../../../_app/immutable/entry/start.Bnp5303b.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/Cugo8Sw9.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/_Roc1N7j.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/Du4uIILg.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/DYGiXs1v.js">
		<link rel="modulepreload" href="../../../_app/immutable/entry/app.gFT0rYy9.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/jKjWACjA.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/CozvbqRy.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/CU3E0FLs.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/B4pklceG.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/pFiT_qqh.js">
		<link rel="modulepreload" href="../../../_app/immutable/nodes/0.BjDQT2Bq.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/CMei0t4b.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/Bgovi1YL.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/D4AmcDfz.js">
		<link rel="modulepreload" href="../../../_app/immutable/nodes/2.CBLjlu0K.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/B0BGekoV.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/BMkXc6el.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/Cv3pZryr.js">
		<link rel="modulepreload" href="../../../_app/immutable/nodes/18.yV7PT1-9.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/Cs1o_ong.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/DyuDGlf2.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/OjqImkSQ.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/Dayddfh2.js"><!--[--><!--]--><!--[--><!--]--><!--[--><!--]--><title>TP ExpressJS - TW3 - Johan Girod</title>
	</head>
	<body data-sveltekit-preload-data="hover">
		<div style="display: contents"><!--[--><!--[--><!----><div class="screen:container prose-h2 container prose prose-slate mx-auto my-12 px-4 lg:prose-xl prose-headings:text-slate-800 prose-h1:font-semibold prose-a:transition prose-a:duration-75 hover:prose-a:text-pink-500 lg:px-0 print:mx-0 print:max-w-none"><!----><!--[--><!----><div class="lg:prose-lg"><div style="view-transition-name: breadcrumb"><div class="mb-2 inline" role="list"><!--[--><li class="inline-block"><a href="/" class="text-pink-600" aria-label="Accueil">Accueil</a> <!--[--><span class="mx-2 text-gray-500">/</span><!--]--></li><li class="inline-block"><a href="/cours/" class="text-pink-600" aria-label="Cours et TP">Cours et TP</a> <!--[--><span class="mx-2 text-gray-500">/</span><!--]--></li><li class="inline-block"><a href="http://sveltekit-prerender/cours/tw3/3-expressJS/" class="text-pink-600" aria-label="...">...</a> <!--[!--><!--]--></li><!--]--></div><!----> <!--[--><span class="ml-2 inline-block rounded-full bg-pink-500 px-2 py-1 text-sm font-semibold text-white">Avec corrigé</span><!--]--></div> <main class="mt-8 prose-h1:inline-block prose-h1:border-y-8 prose-h1:border-pink-500 prose-h1:px-2 prose-h1:pb-3 prose-h1:pt-2 prose-h1:text-4xl prose-h2:text-3xl"><!----><!--[!--><!----><div class="prose-code:radius-none prose-code:font-mono prose-code:font- mt-14 prose-h1:text-5xl prose-h2:text-3xl prose-h2:text-pink-500 prose-p:text-2xl prose-blockquote:text-2xl prose-blockquote:font-normal prose-blockquote:text-pink-500 prose-code:w-auto prose-code:rounded prose-pre:bg-slate-100 prose-pre:text-left prose-pre:text-xl prose-li:text-left prose-li:text-2xl md:-ml-14 md:-mr-14"><div class="reveal rounded-md border border-gray-200 shadow-lg svelte-1xe5mne"><!--[--><div class="absolute z-50 flex h-full w-full items-center justify-center bg-white"><div class="absolute z-50 flex h-full w-full items-center justify-center bg-white"><div class="h-32 w-32 animate-spin"><svg class="h-full w-full text-pink-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0
                                3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg></div></div></div><!--]--> <div class="slides"><!----><section><h1>Serveur web : principes de base</h1> <h2 class="text-pink-500">Technologie web 3</h2> <p class="text-gray-500">Johan Girod</p></section> <section><section><h2>Qu'est-ce qu'un serveur web ?</h2> <ul><li class="fragment">Un programme informatique <strong>accessible depuis internet</strong></li> <li class="fragment">Qui répond à des <strong>requêtes</strong> de clients</li> <li class="fragment">En leur renvoyant des <strong>ressources</strong> web</li></ul></section> <section><h2>Qu'est-ce qu'un serveur web ?</h2> <div class="flex justify-center"><img src="/_app/immutable/assets/RequeteHTTP.qcw6wzKr.png" alt="Schéma d'une requête HTTP"></div></section> <section><h2>Accessible depuis internet</h2> <ul><li>Utilise un <strong>protocole</strong> transport : <strong>TCP</strong></li> <li>Écoute sur un port réseau prédéfini: <strong>80</strong> (HTTP) ou <strong>443</strong> (HTTPS)</li> <li>Utilise le protocole applicatif <strong>HTTP</strong> pour la transmission de ressource</li></ul></section> <section><h2>La requête HTTP</h2> <p>Une requête est un message texte contenant</p> <ul><li>Un <strong>verbe</strong> d'action</li> <li>L'adresse d'une <strong>ressource</strong> à récupérer</li> <li>La <strong>version</strong> du protocole utilisé</li> <li>Des <strong>entêtes</strong> (headers) optionnels</li></ul> <pre class="fragment"><code class="language-http" data-trim="">
			GET /restaurants HTTP/1.0
			Host: example.com
			User-Agent: Mozilla/4.0
			Accept-Language: fr
		</code></pre></section> <section><h2>La réponse HTTP</h2> <p>Une réponse est un message texte contenant</p> <ul><li>Un <strong>code de statut</strong></li> <li>Des <strong>entêtes</strong> (headers) optionnels</li> <li>Le <strong>corps</strong> de la réponse</li></ul> <pre class="fragment"><code class="language-http" data-trim="">
				<script type="text/template">
			HTTP/1.0 200 OK
			Content-Type: text/html
			Content-Length: 1234

			<!DOCTYPE html>
			<html>
				<head>
					<title>Page d'accueil</title>
				</head>
				<body>
					<h1>Bienvenue sur notre site</h1>
				</body>
			</html>
				</script>
		</code></pre> <aside class="notes">Le corps de la réponse peut être de n'importe quel type (texte, image, vidéo, etc.). Ici c'est
			du HTML Le HTML est généré par le serveur et envoyé au client, en réponse de la requête</aside></section> <section><h2>Les framework web</h2> <p>Facilitent la création de serveurs web en permettant de manipuler facilement :</p> <ul><li>Les <strong>routes</strong> et leur <strong>paramètres</strong></li> <li>Les <strong>requêtes</strong> (lecture des entêtes, corps, session, cookies)</li> <li>Les <strong>réponses</strong> (code de statut, entêtes, corps, type-mime, etc.)</li></ul> <aside class="notes">Il en existe une infinité. Chaque langage en a plusieurs. Les principes que vous verrez ici
			sont valables pour tous</aside></section> <section><h2>ExpressJS</h2> <p>Le framework web le plus populaire pour Node.js</p> <h3>Principe de base</h3> <pre><code class="language-js" data-trim="" data-noescape="" data-line-numbers="">
			<script type="text/template">
					app.get('/ma-route', (req, res) => {
						// callback
					});
				</script>
		</code></pre> <aside class="note"><ul><li>Simple à prendre en main</li> <li>Très flexible</li> <li>Très performant</li></ul></aside></section> <section><h2>TP : Créer un serveur web</h2> <p></p> <aside class="note"><ol><li>eslint / prettier / tooling</li> <li>serveur pour un restaurant</li> <li>Servir des fichiers statiques</li> <li>Générer du HTML pour répondre à une requête</li></ol></aside></section></section><!----></div></div></div><!----> <h2>TP ExpressJS</h2> <p>Ce TP vous permettra de vous familiariser avec un framework web (<a href="https://expressjs.com" rel="nofollow"><code>expressjs</code></a>), en créant un site web pour un restaurant.
Ce site contiendra une page d’accueil, une page pour afficher les menus, et une page pour commander un menu.</p> <h3>Objectifs</h3> <ul><li>Avoir une première expérience avec l’architecture MVC</li> <li>Savoir créer un serveur web avec Express et créer des routes</li> <li>Savoir lancer des tests et interpréter les erreurs</li> <li>Servir les fichiers statiques</li> <li>Utiliser un moteur de template pour générer des pages HTML à partir de vues</li> <li>Comprendre l’utilité du <code>layout</code></li> <li>Comprendre et utiliser les query string parameters</li> <li>Savoir traiter un formulaire HTML</li></ul> <h3>Sommaire</h3> <ul><li><a href="#start">Préparatifs</a></li> <li><a href="#exercice-1">Exercice 1 : utiliser le routeur et servir des fichiers statiques</a></li> <li><a href="#exercice-2">Exercice 2 : utiliser un moteur de template</a></li> <li><a href="#exercice-3">Exercice 3 : traiter un formulaire HTTP</a></li> <li><a href="#exercice-4">Exercice 4 : ajouter un middleware pour gérer les erreurs serveurs</a></li></ul> <div id="start"></div> <h3>Préparatifs : installer et lancer le projet</h3> <h4>Prérequis : installation</h4> <p>Pour les besoins de développement, nous allons installer nodeJS en local.</p> <p>Si cela ne fonctionne pas, nous utiliserons une version github codespace, un vscode en ligne avec nodeJS déjà installé.</p> <h4>Installation</h4> <p>Le code se trouve sur github. Pour installer le projet, lancer les commandes suivantes :</p> <!----><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D"># Clone le projet git dans le dossier courant</span></span>
<span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> clone</span><span style="color:#005CC5"> --branch</span><span style="color:#032F62"> start</span><span style="color:#032F62"> https://github.com/johangirod/TP-express</span></span>
<span class="line"><span style="color:#005CC5">cd</span><span style="color:#032F62"> TP-express</span></span>
<span class="line"><span style="color:#6F42C1">npm</span><span style="color:#032F62"> install</span></span></code></pre><!----> <h4>Présentation du projet</h4> <p>Ce projet se compose d’un fichier <code>index.ts</code> contenant le code source de votre serveur, et d’un dossier <code>test</code> contenant les tests (vous n’aurez pas à modifier ce dernier).</p> <p>Le fichier <code>tsconfig.json</code> contient la configuration typescript.</p> <h5>Eslint</h5> <p>Ce projet utilise <a href="https://eslint.org" rel="nofollow">eslint</a> pour vérifier la syntaxe du code. Pour lancer la vérification, lancer la commande <code>npx eslint ./</code>.</p> <p>Le fichier <code>.eslintrc.js</code> contient la configuration d’eslint.</p> <h5>Prettier</h5> <p>Ce projet utilise <a href="https://prettier.io" rel="nofollow">prettier</a> pour formater automatiquement le code. Pour lancer le formatage, lancer la commande <code>npx prettier ./ --write</code>.</p> <p>Le fichier <code>.prettierrc.js</code> contient la configuration de prettier (vide = standard).</p> <h5>Installer les extensions vscode</h5> <p>Pour profiter des annotations eslint et du formattage automatique de prettier dans vscode, il vous suffit d’installer les extensions recommandées du projet. Pour cela, ouvrez le menu des extensions (<code>Ctrl+Maj+X</code>) et cherchez “@recommended”. Vous devriez voir apparaître les extensions suivantes :</p> <ul><li>ESLint</li> <li>Prettier - Code formatter</li></ul> <h4>Lancer le projet</h4> <ol><li>Créez le fichier <code>index.ts</code> à la racine du projet, contenant un simple <code>console.log("hello world")</code></li> <li>Lancez le projet avec la commande <code>npx ts-node-dev index.ts</code>. Vous devriez voir apparaitre « hello world » dans la console.</li></ol> <p><code>ts-node-dev</code> est un outil qui permet d’exécuter un fichier node en typescript. Il est très pratique, car il relance automatiquement le serveur à chaque modification du code source.</p> <h4>Tests</h4> <p>Tout au long du TP, vous pourrez vérifier si vous avez réussi l’exercice en lançant les tests avec la commande <code>npm test</code>.</p> <p>Lancez la commande et vérifiez que tout est vert.</p> <div id="exercice-1"></div> <h3>Exercice 1 : un serveur web static</h3> <p>Pour commencer, allez sur la branche <code>exercice-1</code> du projet :</p> <!----><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> checkout</span><span style="color:#005CC5"> -f</span><span style="color:#032F62"> exercice-1</span></span></code></pre><!----> <p>Le fichier <code>index.html</code> contient la page d’accueil du site. Nous allons maintenant créer un serveur web qui servira cette page.</p> <h4>Ma première route</h4> <p>Nous allons créer une route <code>/ping</code> qui renverra un statut 200.</p> <div class="bg-blue-100 border-l-4 border-blue-500 px-4 py-2"><p class="font-bold text-blue-700"><!----><div slot="title">Codes de réponse HTTP</div><!----></p> <!----><p>Le statut HTTP est un code numérique qui est renvoyé par le serveur pour indiquer le résultat de la requête au client. Le code 200 signifie que la requête a été traitée avec succès. Le code 404 signifie que la ressource demandée n’a pas été trouvée. Nous verrons d’autres codes de statut HTTP plus tard dans ce TP.</p> <p><a href="https://developer.mozilla.org/fr/docs/Web/HTTP/Status" rel="nofollow">En savoir plus</a></p><!----></div><!----> <p>Il vous faudra importer la bibliothèque express, créer une instance de l’application, et ajouter une route <code>/ping</code> qui renvoie un statut 200.</p> <ol><li>Installez express avec la commande <code>npm install express</code></li> <li>Installez les types typescript de express avec la commande <code>npm install -D @types/express</code></li> <li>Importez express dans le fichier <code>index.ts</code> avec <code>import express from 'express'</code></li> <li>Créez une instance de l’application express avec <code>const app = express()</code></li> <li>Ajoutez une route <code>/ping</code> qui renvoie un statut 200 avec la méthode <a href="https://expressjs.com/fr/4x/api.html#app.get.method" rel="nofollow"><code>app.get</code></a></li> <li>Faire en sorte que le serveur écoute sur le port 3000 avec la méthode <a href="https://expressjs.com/fr/4x/api.html#app.listen" rel="nofollow"><code>app.listen</code></a></li> <li>Lancez le serveur avec <code>npx ts-node-dev index.ts</code></li> <li>Lancez les tests avec <code>npm test</code></li> <li>Optionnel : ouvrez votre navigateur et allez sur <code>http://localhost:3000/ping</code></li></ol> <!--[--><div class="-ml-5 border-l-2 border-dotted border-pink-500 pl-4"><span class="mr-2 inline-block rounded-full bg-pink-500 px-2 py-1 text-sm font-semibold text-white">Corrigé</span> <button class="inline-block text-sm text-gray-500 hover:text-gray-700" aria-label="Afficher la solution" aria-expanded="false" aria-controls="bxf7x89pdjh"><!--[!-->Afficher<!--]--></button> <!--[!--><!--]--></div><!--]--><!----> <h4>Servir la page d’accueil</h4> <p>Nous allons maintenant servir la page <code>index.html</code> lorsque l’utilisateur se rend sur la page d’accueil du site. Pour cela, vous créerez une route <code>/</code> qui renvoie le fichier <code>index.html</code>.</p> <p>Pour cela, vous utiliserez la méthode <a href="https://expressjs.com/fr/4x/api.html#res.sendFile" rel="nofollow"><code>sendFile</code></a> de l’objet <code>res</code>.</p> <p>Pour construire le chemin du fichier, vous utiliserez la méthode <a href="https://nodejs.org/api/path.html#path_path_join_paths" rel="nofollow"><code>join</code></a> du module <code>path</code>. Et pour récupérer le chemin absolu du dossier racine, vous utiliserez la variable <code>__dirname</code>.</p> <!--[--><div class="-ml-5 border-l-2 border-dotted border-pink-500 pl-4"><span class="mr-2 inline-block rounded-full bg-pink-500 px-2 py-1 text-sm font-semibold text-white">Corrigé</span> <button class="inline-block text-sm text-gray-500 hover:text-gray-700" aria-label="Afficher la solution" aria-expanded="false" aria-controls="ly8e97ozgkp"><!--[!-->Afficher<!--]--></button> <!--[!--><!--]--></div><!--]--><!----> <h4>Servir les fichiers statiques (images, css, etc.)</h4> <p>Tous les fichiers statiques (images, css, etc.) se trouvent dans le dossier <code>assets</code>. Nous allons maintenant servir ces fichiers statiques, en montant le dossier <code>assets</code> sur le chemin <code>/assets</code>.</p> <p>Pour cela vous utiliserez la méthode <a href="https://expressjs.com/fr/4x/api.html#express.static" rel="nofollow"><code>express.static</code></a>.</p> <!--[--><div class="-ml-5 border-l-2 border-dotted border-pink-500 pl-4"><span class="mr-2 inline-block rounded-full bg-pink-500 px-2 py-1 text-sm font-semibold text-white">Corrigé</span> <button class="inline-block text-sm text-gray-500 hover:text-gray-700" aria-label="Afficher la solution" aria-expanded="false" aria-controls="lqfe5sjcdwg"><!--[!-->Afficher<!--]--></button> <!--[!--><!--]--></div><!--]--><!----> <h4>Tester le serveur</h4> <p>Vérifiez que tout fonctionne en lançant les tests avec <code>npm test</code> avant de passer à l’exercice suivant.</p> <div id="exercice-2"></div> <h3>Exercice 2 : Utiliser un moteur de template</h3> <p>Nous allons à présent utiliser un moteur de template pour générer les pages HTML à partir des données de l’application. Il en existe <a href="https://expressjs.com/fr/resources/template-engines.html" rel="nofollow">plusieurs</a>, nous utiliserons <a href="https://handlebarsjs.com/" rel="nofollow">handlebars</a>.</p> <p>Pour commencer, allez sur la branche <code>exercice-2</code> du projet :</p> <!----><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> checkout</span><span style="color:#005CC5"> -f</span><span style="color:#032F62"> exercice-2</span></span></code></pre><!----> <p>Un nouveau dossier <code>models</code> a été créé, contenant un fichier <code>restaurant.ts</code> qui contient les données du restaurant. Nous allons utiliser ces données pour générer les pages du site qui seront situées dans le dossier <code>views</code>.</p> <div class="bg-blue-100 border-l-4 border-blue-500 px-4 py-2"><p class="font-bold text-blue-700"><!----><div slot="title">Moteur de template</div><!----></p> <!----><p>Un moteur de template est un outil qui permet de générer des pages HTML à partir de données. Il permet de séparer le code HTML du code JavaScript, et de générer des pages HTML dynamiques. C’est un outil utilisé dans les applications web qui suivent le <a href="https://fr.wikipedia.org/wiki/Mod%C3%A8le-vue-contr%C3%B4leur" rel="nofollow">pattern MVC</a>.</p><!----></div><!----> <h4>Mettre en place handlebars</h4> <ol><li>Renommez le fichier <code>index.html</code> en <code>home.handlebars</code> et déplacez-le dans un nouveau dossier <code>views</code></li> <li>Installez le moteur de template handlebars pour express <code>express-handlebars</code> en suivant les instructions de la <a href="https://github.com/express-handlebars/express-handlebars#installation" rel="nofollow">documentation</a></li> <li>Vérifiez que les tests de l’exercice 1 passent toujours grâce à la commande <code>npm test exercice-1</code>. Si ce n’est pas le cas, corrigez le code.</li></ol> <!--[--><div class="-ml-5 border-l-2 border-dotted border-pink-500 pl-4"><span class="mr-2 inline-block rounded-full bg-pink-500 px-2 py-1 text-sm font-semibold text-white">Corrigé</span> <button class="inline-block text-sm text-gray-500 hover:text-gray-700" aria-label="Afficher la solution" aria-expanded="false" aria-controls="olytdizu41a"><!--[!-->Afficher<!--]--></button> <!--[!--><!--]--></div><!--]--><!----> <h4>Changer le nom et la description du restaurant</h4> <ol><li>Dans le fichier <code>home.handlebars</code>, remplacez le nom du restaurant par <code>{{name}}</code> et la description par <code>{{description}}</code></li> <li>Dans le fichier <code>index.ts</code>, importez le fichier <code>restaurant.ts</code> avec <code>import restaurant from "./models/restaurant"</code></li> <li>Passez les données du restaurant au moteur de template via <a href="https://expressjs.com/fr/4x/api.html#res.render" rel="nofollow"><code>res.render</code></a></li></ol> <!--[--><div class="-ml-5 border-l-2 border-dotted border-pink-500 pl-4"><span class="mr-2 inline-block rounded-full bg-pink-500 px-2 py-1 text-sm font-semibold text-white">Corrigé</span> <button class="inline-block text-sm text-gray-500 hover:text-gray-700" aria-label="Afficher la solution" aria-expanded="false" aria-controls="67xnyadrko"><!--[!-->Afficher<!--]--></button> <!--[!--><!--]--></div><!--]--><!----> <h4>Utiliser les layouts</h4> <p>Un layout est un fichier qui contient le squelette de la page. Il permet de factoriser le code HTML commun à toutes les pages du site, comme le header et le footer. Nous allons mettre à jour le layout par défaut <code>main.handlebars</code>, et laisser la possibilité de paramétrer le titre de la page.</p> <ol><li>Déplacez le code HTML commun dans le fichier <code>main.handlebars</code> de telle sorte que le fichier <code>home.handlebars</code> ne contienne que le contenu spécifique à la page d’accueil (ce qui se trouve à l’intérieur de la balise <code>&lt;div class="row ..."></code>).</li> <li>Changez le titre de la page d’accueil (balise <code>&lt;title></code>) par <code>&lt;nom du restaurant></code></li> <li>Faire en sorte que les tests « Exercice 1 - Home » passent</li></ol> <!--[--><div class="-ml-5 border-l-2 border-dotted border-pink-500 pl-4"><span class="mr-2 inline-block rounded-full bg-pink-500 px-2 py-1 text-sm font-semibold text-white">Corrigé</span> <button class="inline-block text-sm text-gray-500 hover:text-gray-700" aria-label="Afficher la solution" aria-expanded="false" aria-controls="q0x3601r659"><!--[!-->Afficher<!--]--></button> <!--[!--><!--]--></div><!--]--><!----> <h4>Créer une page pour afficher le menu</h4> <p>Voici le template bootstrap proposé pour un menu :</p> <!----><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">&#x3C;</span><span style="color:#22863A">div</span><span style="color:#6F42C1"> class=</span><span style="color:#032F62">"col"</span><span style="color:#24292E"> data-test-menu></span></span>
<span class="line"><span style="color:#24292E">  &#x3C;</span><span style="color:#22863A">div</span><span style="color:#6F42C1"> class=</span><span style="color:#032F62">"card h-100"</span><span style="color:#6F42C1"> role=</span><span style="color:#032F62">"list-item"</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">    &#x3C;</span><span style="color:#22863A">div</span><span style="color:#6F42C1"> class=</span><span style="color:#032F62">"card-body"</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">      &#x3C;</span><span style="color:#22863A">h2</span><span style="color:#6F42C1"> class=</span><span style="color:#032F62">"card-title"</span><span style="color:#24292E">></span><span style="color:#005CC5">&#123;&#123;</span><span style="color:#E36209">name</span><span style="color:#005CC5">&#125;&#125;</span><span style="color:#24292E">&#x3C;/</span><span style="color:#22863A">h5</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">      &#x3C;</span><span style="color:#22863A">p</span><span style="color:#6F42C1"> class=</span><span style="color:#032F62">"card-text"</span><span style="color:#24292E">></span><span style="color:#005CC5">&#123;&#123;</span><span style="color:#E36209">description</span><span style="color:#005CC5">&#125;&#125;</span><span style="color:#24292E">&#x3C;/</span><span style="color:#22863A">p</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">      &#x3C;</span><span style="color:#22863A">p</span><span style="color:#6F42C1"> class=</span><span style="color:#032F62">"card-text"</span><span style="color:#24292E">></span><span style="color:#005CC5">&#123;&#123;</span><span style="color:#E36209">price</span><span style="color:#005CC5">&#125;&#125;</span><span style="color:#24292E">€&#x3C;/</span><span style="color:#22863A">p</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">    &#x3C;/</span><span style="color:#22863A">div</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">  &#x3C;/</span><span style="color:#22863A">div</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">&#x3C;/</span><span style="color:#22863A">div</span><span style="color:#24292E">></span></span></code></pre><!----> <p>Voici le container pour afficher les menus :</p> <!----><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">&#x3C;</span><span style="color:#22863A">div</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">"row row-cols-1 row-cols-md-3 g-4"</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#6A737D">	&#x3C;!-- Ici, on affichera les menus --></span></span>
<span class="line"><span style="color:#24292E">&#x3C;/</span><span style="color:#22863A">div</span><span style="color:#24292E">></span></span></code></pre><!----> <p>Créez une nouvelle page <code>menu.handlebars</code>, servi sur l’URL <code>/menus</code> qui affiche les menus du restaurant présents dans <code>models/menus</code>. Pour éviter de dupliquer le code HTML, vous le bloc handlebars <a href="https://handlebarsjs.com/guide/builtin-helpers.html#each" rel="nofollow"><code>{{#each}}</code></a> pour afficher tous les menus. Cette page aura un titre <code>&lt;h1></code> « Menus » et pour titre de page (balise <code>&lt;title></code>) <code>Menus - &lt;nom du restaurant></code></p> <ol><li>Creer la vue <code>menu.handlebars</code> dans le dossier <code>views</code></li> <li>Servir cette page sur le route <code>/menus</code> grâce à <code>app.get</code> et <code>res.render</code></li> <li>Passer la variable <code>menus</code> au moteur de template comme argument de <code>res.render</code></li> <li>Utiliser <code>{{#each}}</code> dans la vue pour afficher tous les menus</li> <li>Modifier le titre de la page pour qu’il soit dynamique <code>Menus - &lt;nom du restaurant></code> (<code>&lt;nom du restaurant></code> vient du fichier <code>restaurant.ts</code>)</li></ol> <!--[--><div class="-ml-5 border-l-2 border-dotted border-pink-500 pl-4"><span class="mr-2 inline-block rounded-full bg-pink-500 px-2 py-1 text-sm font-semibold text-white">Corrigé</span> <button class="inline-block text-sm text-gray-500 hover:text-gray-700" aria-label="Afficher la solution" aria-expanded="false" aria-controls="geapg3mi8r"><!--[!-->Afficher<!--]--></button> <!--[!--><!--]--></div><!--]--><!----> <h3>Créer une page pour commander un menu</h3> <p>Nous allons ajouter un bouton sur les menus pour pouvoir les commander. Ce bouton doit rediriger vers la page <code>/commander</code>. Pour passer au serveur l’identifiant du menu, nous allons utiliser un paramètre de l’URL (appelé <code>query string parameter</code>). Par exemple, pour le menu avec l’identifiant <code>xid327y</code>, l’URL sera <code>/commander?menu=xid327y</code>.</p> <p>Voici le code du bouton :</p> <!----><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">&#x3C;!-- contenu du menu --></span></span>
<span class="line"><span style="color:#6A737D">&#x3C;!-- ... --></span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">&#x3C;</span><span style="color:#22863A">div</span><span style="color:#6F42C1"> class=</span><span style="color:#032F62">'p-3'</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">	&#x3C;</span><span style="color:#22863A">a</span><span style="color:#6F42C1"> href=</span><span style="color:#032F62">'/commander?menu=</span><span style="color:#005CC5">&#123;&#123;id&#125;&#125;</span><span style="color:#032F62">'</span><span style="color:#6F42C1"> class=</span><span style="color:#032F62">'btn btn-secondary'</span><span style="color:#24292E">>Commander&#x3C;/</span><span style="color:#22863A">a</span><span style="color:#24292E">></span></span>
<span class="line"><span style="color:#24292E">&#x3C;/</span><span style="color:#22863A">div</span><span style="color:#24292E">></span></span></code></pre><!----> <div class="bg-blue-100 border-l-4 border-blue-500 px-4 py-2"><p class="font-bold text-blue-700"><!----><div slot="title">Query string</div><!----></p> <!----><p>Un query string est une chaîne de caractères qui suit le chemin de l’URL et qui contient des paramètres. Il est séparé du chemin par un point d’interrogation <code>?</code>, et chaque paramètre est séparé par un <code>&amp;</code>. Par exemple, l’URL <code>https://example.com/path?param1=value1&amp;param2=value2</code> contient deux paramètres : <code>param1</code> et <code>param2</code>.</p> <p>Il est possible de récuperer les paramètres d’une requête HTTP avec la propriété <code>query</code> de l’objet <code>req</code>.</p><!----></div><!----> <ol><li>Ajouter un bouton « Commander » sur chaque menu qui redirige vers la page <code>/commander</code> avec l’identifiant du menu en paramètre</li> <li>Créer une page <code>commande.handlebars</code> qui le nom du menu commandé. Cette page aura un titre <code>&lt;h1></code> « Votre commande : menu <nom du="" menu="">» et pour titre de page (balise <code>&lt;title></code>) <code>Commander - &lt;nom du restaurant></code></nom></li> <li>Servez cette vue sur la route <code>/commander</code> grâce à <code>app.get</code> et <code>res.render</code></li> <li>Pour récupérer l’<code>id</code> passé en paramètre de requête, vous pourrez utiliser <code>req.query</code></li> <li>Rechercher dans l’array <code>menu</code> celui qui correspond à l’id en entrée</li> <li>Passer le nom du menu concerné à la vue, comme paramètre de <code>res.render</code></li></ol> <p><em>Aide : vous pourrez utiliser la méthode <code>Array.find</code> pour retrouver le bon menu à partir de l’identifiant</em></p> <!--[--><div class="-ml-5 border-l-2 border-dotted border-pink-500 pl-4"><span class="mr-2 inline-block rounded-full bg-pink-500 px-2 py-1 text-sm font-semibold text-white">Corrigé</span> <button class="inline-block text-sm text-gray-500 hover:text-gray-700" aria-label="Afficher la solution" aria-expanded="false" aria-controls="nhpdyv3gwx"><!--[!-->Afficher<!--]--></button> <!--[!--><!--]--></div><!--]--><!----> <p>Avant de passer à l’exercice suivant, vérifiez que les tests passent avec <code>npm test</code>.</p> <div id="exercice-3"></div> <h3>Exercice 3 : traiter un formulaire HTTP</h3> <p>Nous allons maintenant créer un formulaire pour commander un menu. Ce formulaire contiendra un champ pour le nom, un champ pour l’adresse, et un champ pour le numéro de téléphone. Lorsque l’utilisateur soumettra le formulaire, un message de confirmation s’affichera, lui rappelant ses informations saisies.</p> <h4>Créer le formulaire</h4> <ol><li><p>Sur la page <code>commander.handlebars</code>, créez un formulaire avec la balise <code>&lt;form></code> et des balises <code>&lt;input></code> qui contient les champs suivants :</p> <ul><li>un champ <code>name</code> de type <code>text</code> avec le label « Nom »</li> <li>un champ <code>address</code> de type <code>text</code> avec le label « Adresse »</li> <li>un champ <code>phone</code> de type <code>tel</code> avec le label « Téléphone »</li> <li>un bouton « Commander » de type <code>submit</code></li></ul></li> <li><p>Créez une route <code>/commander</code> en <code>post</code> qui extrait les données du formulaire et les fourni à la vue <code>commander.handlebars</code>. Vous utiliserez <code>app.post</code>. Pour récupérer automatiquement les données du formulaire, il faudra ajouter un middleware spécifique : <code>app.use(express.urlencoded())</code></p></li> <li><p>Vérifiez que la route est bien appelée lorsque vous soumettez le formulaire. Pour cela, vous pouvez ajouter un <code>console.log</code> et vérifier si il apparaît dans le terminal.</p></li> <li><p>Modifier la vue <code>commander.handlebars</code> pour ajouter un message de confirmation lorsque les données du formulaire sont présentes. Ce message doit contenir le nom, l’adresse et le téléphone du client.</p></li> <li><p>Veillez à ce que la page continue d’afficher le nom du menu commandé</p></li></ol> <p><em>Astuce : vous pourriez avoir besoin de <a href="https://developer.mozilla.org/fr/docs/Web/HTML/Element/Input/hidden" rel="nofollow"><code>&lt;input type="hidden"></code></a> et de <a href="https://developer.mozilla.org/fr/docs/Web/HTML/Element/Form" rel="nofollow"><code>&lt;form method="post"></code></a></em></p> <div class="bg-blue-100 border-l-4 border-blue-500 px-4 py-2"><p class="font-bold text-blue-700"><!----><div slot="title">POST vs GET</div><!----></p> <!----><p>Il existe plusieurs méthodes HTTP, permettant d’indiquer une intention au serveur. Les deux plus courantes sont <code>GET</code> et <code>POST</code>.</p> <ul><li>La méthode <code>GET</code> est utilisée pour récupérer des données. Lorsqu’on saisit une URL dans le navigateur, ce dernier utilise la méthode <code>GET</code>.</li> <li>La méthode <code>POST</code> est utilisée pour envoyer des données. Elle signifie que l’on souhaite effectuer une action qui va modifier un état sur le serveur.</li></ul> <p>Les données de la méthode <code>POST</code> sont envoyées dans le corps de la requête HTTP, et non dans l’URL. Cela permet de transmettre des données plus importantes, comme des fichiers. Pour récupérer les données postées avec un formulaire, on utilise un middleware express appelé <code>express.urlencoded()</code> qui les transforme en objet JavaScript et les ajoute à l’objet <code>req.body</code>.</p><!----></div><!----> <br> <!--[--><div class="-ml-5 border-l-2 border-dotted border-pink-500 pl-4"><span class="mr-2 inline-block rounded-full bg-pink-500 px-2 py-1 text-sm font-semibold text-white">Corrigé</span> <button class="inline-block text-sm text-gray-500 hover:text-gray-700" aria-label="Afficher la solution" aria-expanded="false" aria-controls="xw84nyurm2n"><!--[!-->Afficher<!--]--></button> <!--[!--><!--]--></div><!--]--><!----> <div id="exercice-4"></div> <h3>Exercice 4 : ajouter un middleware pour gérer les erreurs serveurs</h3> <div class="bg-blue-100 border-l-4 border-blue-500 px-4 py-2"><p class="font-bold text-blue-700"><!----><div slot="title">Middleware</div><!----></p> <!----><p>Un middleware est une fonction de callback qui prend en paramètre un objet <code>req</code>, un objet <code>res</code>, et une fonction <code>next</code>. Il est utilisé pour effectuer des opérations communes à plusieurs routes, comme la vérification des autorisations, la gestion des erreurs, ou le formatage des données.</p> <!----><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">app.</span><span style="color:#6F42C1">use</span><span style="color:#24292E">((</span><span style="color:#E36209">req</span><span style="color:#24292E">, </span><span style="color:#E36209">res</span><span style="color:#24292E">, </span><span style="color:#E36209">next</span><span style="color:#24292E">) </span><span style="color:#D73A49">=></span><span style="color:#24292E"> &#123;</span></span>
<span class="line"><span style="color:#6A737D">	// Ce code est appelé avant chaque route handler (get, post, etc.)</span></span>
<span class="line"><span style="color:#24292E">	console.</span><span style="color:#6F42C1">log</span><span style="color:#24292E">(</span><span style="color:#032F62">'Entrée dans le middleware'</span><span style="color:#24292E">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">	// L'appelle à &#96;next()&#96; permet de passer la main au middleware suivant, ou au route handler si il n'y a plus de middleware</span></span>
<span class="line"><span style="color:#6F42C1">	next</span><span style="color:#24292E">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">	// Ce code est appelé après chaque route.</span></span>
<span class="line"><span style="color:#6A737D">	// On peut accéder à la réponse de la route avec res</span></span>
<span class="line"><span style="color:#24292E">	console.</span><span style="color:#6F42C1">log</span><span style="color:#24292E">(</span><span style="color:#032F62">'Sortie du middleware'</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">&#125;);</span></span></code></pre><!----> <p><em>A noter : l’ordre des middleware est important. Ils sont exécutés dans l’ordre où ils sont déclarés. Par ailleurs, ils doivent être déclarés avant les routes qui les utilisent.</em></p> <p><a href="https://expressjs.com/en/guide/writing-middleware.html" rel="nofollow">Voir le guide express sur les middlewares</a></p><!----></div><!----> <h4>Gérer les erreurs 404</h4> <ol><li>Créer une vue <code>erreur.handlebars</code> qui affiche un message « Page non trouvée » lorsque le code erreur est 404.</li> <li>Implémenter un middleware express qui affiche la vue avec les bons paramètres lorsqu’une page n’est pas trouvée</li></ol> <h4>Gérer les erreurs 500</h4> <ol><li>Modifier la vue <code>erreur.handlebars</code> pour afficher le message « Erreur serveur » lorsque le code erreur est 500.</li> <li>Implémenter un middleware express qui affiche la vue avec les bons paramètres lorsqu’une erreur se produit</li></ol> <!--[--><div class="-ml-5 border-l-2 border-dotted border-pink-500 pl-4"><span class="mr-2 inline-block rounded-full bg-pink-500 px-2 py-1 text-sm font-semibold text-white">Corrigé</span> <button class="inline-block text-sm text-gray-500 hover:text-gray-700" aria-label="Afficher la solution" aria-expanded="false" aria-controls="62wegxg6f77"><!--[!-->Afficher<!--]--></button> <!--[!--><!--]--></div><!--]--><!----> <h3>Exercice 5 : améliorations (bonus)</h3> <h4>Post/Redirect/Get</h4> <p>Après avoir saisi la commande, on reste sur la même url, ce qui signifie que si l’utilisateur rafraichit la page, le formulaire est renvoyé. Pour éviter cela, on peut utiliser le pattern <a href="https://fr.wikipedia.org/wiki/Post-Redirect-Get" rel="nofollow">Post/Redirect/Get</a> : après avoir traité le formulaire, on redirige l’utilisateur vers une autre page. Il ne pourra donc pas renvoyer le formulaire en rafraichissant la page.</p> <h4>Utiliser un paramètre de l’URL</h4> <p>Plutôt que d’utiliser un query string pour passer l’identifiant du menu, on peut utiliser un paramètre de l’URL. Cela éviterait d’avoir à se servir de input hidden. Par exemple, l’URL <code>/commander/1</code> permet de passer l’identifiant du menu <code>1</code>. Pour cela, il faut utiliser un paramètre de l’UgwsRL, et non un query string. On peut utiliser la méthode <a href="https://expressjs.com/fr/4x/api.html#app.param" rel="nofollow"><code>app.param</code></a> pour récupérer le menu à partir de l’identifiant, et le passer à la vue.</p> <h4>Refacto</h4> <p>Tout le code source est dans le fichier <code>index.ts</code>. Il serait préférable de séparer le code en plusieurs fichiers, par exemple un fichier <code>controllers.ts</code> qui contient les routes et laisser le fichier <code>index.ts</code> pour la configuration du serveur.</p> <h4>Validation du formulaire</h4> <p>Lors de la soumission du formulaire, on pourrait vérifier que les champs sont bien remplis, et afficher un message d’erreur sur le champs concerné si ce n’est pas le cas. Par ailleurs, on pourrait vérifier que le numéro de téléphone est bien un numéro de téléphone valide.</p><!----><!--]--><!----></main></div><!----><!--]--><!----></div><!----><!--]--> <!--[!--><!--]--><!--]-->
			
			<script>
				{
					__sveltekit_pqo0dy = {
						base: new URL("../../..", location).pathname.slice(0, -1)
					};

					const element = document.currentScript.parentElement;

					Promise.all([
						import("../../../_app/immutable/entry/start.Bnp5303b.js"),
						import("../../../_app/immutable/entry/app.gFT0rYy9.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 2, 18],
							data: [{"type":"data","data":null,"uses":{}},null,null],
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
	</body>
</html>
