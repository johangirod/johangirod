<!doctype html>
<html lang="fr">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="../../../favicon.png" />

		<meta name="viewport" content="width=device-width" />
		
		<link href="../../../_app/immutable/assets/0.DeOizrWX.css" rel="stylesheet">
		<link href="../../../_app/immutable/assets/2.Dz1qT87F.css" rel="stylesheet">
		<link href="../../../_app/immutable/assets/Reveal.BYkb6MAx.css" rel="stylesheet">
		<link rel="modulepreload" href="../../../_app/immutable/entry/start.Bnp5303b.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/Cugo8Sw9.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/_Roc1N7j.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/Du4uIILg.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/DYGiXs1v.js">
		<link rel="modulepreload" href="../../../_app/immutable/entry/app.gFT0rYy9.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/jKjWACjA.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/CozvbqRy.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/CU3E0FLs.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/B4pklceG.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/pFiT_qqh.js">
		<link rel="modulepreload" href="../../../_app/immutable/nodes/0.BjDQT2Bq.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/CMei0t4b.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/Bgovi1YL.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/D4AmcDfz.js">
		<link rel="modulepreload" href="../../../_app/immutable/nodes/2.CBLjlu0K.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/B0BGekoV.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/BMkXc6el.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/Cv3pZryr.js">
		<link rel="modulepreload" href="../../../_app/immutable/nodes/3.B95jCVCL.js">
		<link rel="modulepreload" href="../../../_app/immutable/nodes/12.C1SdY8Ba.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/Cs1o_ong.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/OjqImkSQ.js">
		<link rel="modulepreload" href="../../../_app/immutable/chunks/Dayddfh2.js"><!--[--><!--]--><!--[--><!--]--><title>Johan Girod</title>
	</head>
	<body data-sveltekit-preload-data="hover">
		<div style="display: contents"><!--[--><!--[--><!----><div class="screen:container prose-h2 container prose prose-slate mx-auto my-12 px-4 lg:prose-xl prose-headings:text-slate-800 prose-h1:font-semibold prose-a:transition prose-a:duration-75 hover:prose-a:text-pink-500 lg:px-0 print:mx-0 print:max-w-none"><!----><!--[--><!----><div class="lg:prose-lg"><div style="view-transition-name: breadcrumb"><div class="mb-2 inline" role="list"><!--[--><li class="inline-block"><a href="/" class="text-pink-600" aria-label="Accueil">Accueil</a> <!--[--><span class="mx-2 text-gray-500">/</span><!--]--></li><li class="inline-block"><a href="/cours/" class="text-pink-600" aria-label="Cours et TP">Cours et TP</a> <!--[--><span class="mx-2 text-gray-500">/</span><!--]--></li><li class="inline-block"><a href="http://sveltekit-prerender/cours/tw2/6-asynchronicite-et-thread/" class="text-pink-600" aria-label="...">...</a> <!--[!--><!--]--></li><!--]--></div><!----> <!--[--><span class="ml-2 inline-block rounded-full bg-pink-500 px-2 py-1 text-sm font-semibold text-white">Avec corrigé</span><!--]--></div> <main class="mt-8 prose-h1:inline-block prose-h1:border-y-8 prose-h1:border-pink-500 prose-h1:px-2 prose-h1:pb-3 prose-h1:pt-2 prose-h1:text-4xl prose-h2:text-3xl"><!----><!--[--><!----><!----><!--[!--><!----><div class="prose-code:radius-none prose-code:font-mono prose-code:font- mt-14 prose-h1:text-5xl prose-h2:text-3xl prose-h2:text-pink-500 prose-p:text-2xl prose-blockquote:text-2xl prose-blockquote:font-normal prose-blockquote:text-pink-500 prose-code:w-auto prose-code:rounded prose-pre:bg-slate-100 prose-pre:text-left prose-pre:text-xl prose-li:text-left prose-li:text-2xl md:-ml-14 md:-mr-14"><div class="reveal rounded-md border border-gray-200 shadow-lg svelte-1xe5mne"><!--[--><div class="absolute z-50 flex h-full w-full items-center justify-center bg-white"><div class="absolute z-50 flex h-full w-full items-center justify-center bg-white"><div class="h-32 w-32 animate-spin"><svg class="h-full w-full text-pink-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0
                                3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg></div></div></div><!--]--> <div class="slides"><!----><section><h1>Thread et asynchronicité</h1> <h2 class="text-pink-500">Technologie web 2</h2> <p class="text-gray-500">Johan Girod</p></section> <section><section data-auto-animate="true"><h1>Synchrone ou asynchrone</h1></section> <section data-auto-animate="true"><h1>Synchrone ou asynchrone</h1> <h2>Execution synchrone</h2> <ul><li class="fragment">Chaque tache est exécutées l'une après l'autre</li> <li class="fragment">Le déroulé est bloqué tant qu'une tache n'est pas terminée</li></ul></section> <section data-auto-animate="true"><h1>Synchrone ou asynchrone</h1> <h2>Execution asynchrone</h2> <ul><li class="fragment">Plusieurs tâches peuvent être lancées en même temps</li> <li class="fragment">Elles ne bloquent pas le déroulé, et d'autres événements peuvent être traités</li></ul></section> <section data-auto-animate="true"><h1>Synchrone ou asynchrone</h1> <img src="/_app/immutable/assets/async_or_sync.-fhkRSny.png" alt="Asynchrone ou synchrone" class="r-stretch"></section> <section data-auto-animate="true"><h2>Quelques exemples</h2> <ul><li class="fragment">Une conversation téléphonique ? <span class="fragment text-green-500">synchrone</span></li> <li class="fragment">Une conversation par messagerie ? <span class="fragment text-green-500">asynchrone</span></li> <li class="fragment">Un paiement à la caisse ? <span class="fragment text-green-500">synchrone</span></li> <li class="fragment">Une préparation de repas ? <span class="fragment text-green-500">asynchrone</span></li></ul></section> <!--[--><section data-auto-animate=""><h2>Quelques exemples</h2> <h3>Code synchrone ou asynchrone ?</h3> <pre><code class="language-js" data-trim="" data-noescape="">
			<!--[-->
						<script type="text/template">
							const a = 1;
							const b = 2;
							const c = a + b;
						</script>
					<!--]-->
				</code></pre> <!--[!--><!--]--></section><section data-auto-animate=""><h2>Quelques exemples</h2> <h3>Code synchrone ou asynchrone ?</h3> <pre><code class="language-js" data-trim="" data-noescape="">
			<!--[2-->
						<script type="text/template">
							setTimeout(() => {
								console.log('Hello');
							}, 1000);
						</script>
					<!--]-->
				</code></pre> <!--[!--><!--]--></section><section data-auto-animate=""><h2>Quelques exemples</h2> <h3>Code synchrone ou asynchrone ?</h3> <pre><code class="language-js" data-trim="" data-noescape="">
			<!--[1-->
						<script type="text/template">
							function main() {
								const a = fibonacci(10);
								console.log(a);
							}

							function fibonacci(n) {
								if (n <= 1) {
									return n;
								}
								return fibonacci(n - 1) + fibonacci(n - 2);
							}

							main();
						</script>
					<!--]-->
				</code></pre> <!--[!--><!--]--></section><section data-auto-animate=""><h2>Quelques exemples</h2> <h3>Code synchrone ou asynchrone ?</h3> <pre><code class="language-js" data-trim="" data-noescape="">
			<!--[3-->
						<script type="text/template">
							let count = 0;
							document.addEventListener('click', () => {
								count++;
							});
						</script>
					<!--]-->
				</code></pre> <!--[!--><!--]--></section><!--]--></section> <section><section><h1>Thread en JavaScript</h1></section> <section data-auto-animate="true"><h2>Qu'est-ce qu'un thread ?</h2> <ul><li class="fragment">Un thread est un fil d'exécution</li> <li class="fragment">Un programme peut avoir plusieurs threads</li> <li class="fragment">Chaque thread ne peut exécuter qu'une instruction à la fois</li></ul></section> <section><h2>Thread et JavaScript</h2> <ul><li class="fragment">Un programme JavaScript est executé dans un unique <strong>thread principal</strong> (« main
				thread »)<br> <small class="text-gray-500">Les instructions sont exécutées l'une après l'autre</small></li> <li class="fragment">Ce thread est <strong>non bloquant</strong> (asynchrone)<br> <small class="text-gray-500">Les instructions asynchrones ne bloquent pas le déroulé et sont exécutées en parallèle</small></li> <li class="fragment">Les fonctions <strong>fonction de callback</strong> sont placées dans la <strong>file d'attente</strong> (« event loop ») <small class="text-gray-500">Elles sont exécutées dès que le thread principal est disponible, dans l'ordre d'arrivée</small></li></ul></section> <section><h2>`setTimeout`</h2> <pre><code class="language-js" data-trim="" data-noescape="">
		<script type="text/template">
					function maFonctionDeRappel() {
						console.log('B');
					}
					console.log('A');
					setTimeout(maFonctionDeRappel, 100);
					setTimeout(() => {
						console.log('C');
					}, 0);
					console.log('D');
				</script>
			</code></pre> <p class="fragment text-gray-500">Le code est exécuté dans l'ordre A, D, C, B</p></section> <section><h2>`setTimeout`</h2> <pre><code class="language-js" data-trim="" data-noescape="">
		<script type="text/template">
					console.log('A');
					const array = ['B', 'C'];
					array.forEach((item) => {
						setTimeout(() => {
							console.log(item);
						}, 0);
					});
					console.log('D');
				</script>
			</code></pre> <p class="fragment text-gray-500">Le code est exécuté dans l'ordre A, D, B, C</p></section> <section><h2>Perfomance</h2> <p>Si on effectue une tâche longue dans le thread principal, cela peut bloquer l'interface
			utilisateur, car les événements ne sont plus traités</p> <p class="fragment">Dans ce cas, il vaut mieux effectuer la tâche dans un autre thread : c'est le rôle des Web
			Workers</p></section> <section><h2>Callback hell</h2> <p>Lorsqu'on imbrique trop de fonctions de rappel, le code devient illisible</p> <pre><code class="language-js" data-trim="" data-noescape="">
		<script type="text/template">
					setTimeout(() => {
						console.log('A');
						setTimeout(() => {
							console.log('B');
							setTimeout(() => {
								console.log('C');
								setTimeout(() => {
									console.log('D');
								}, 1000);
							}, 1000);
						}, 1000);
					}, 1000);
				</script>
			</code></pre> <p class="fragment text-gray-500">Pour cela, il existe une fonctionnalité du langage : les promesse et les fonctions async/await</p> <p class="fragment text-gray-500">...que vous verrez l'année prochaine</p></section></section><!----></div></div></div><!----> <h2>TP-6 : Un système de particules</h2> <p>Nous allons implémenter un système de particules en JavaScript, grâce à la balise <code>canvas</code>.</p> <p>Voici une capture d’écran de ce que nous allons réaliser :</p> <div style="background-color: black"><p><img src="/_app/immutable/assets/canvas.CbOGdMuP.png"></p></div> <p>Bien sûr dans notre cas, les particules se déplaceront.</p> <h3>1. Création du canvas</h3> <p>Le <code>canvas</code> est une balise HTML qui permet de dessiner des graphiques en 2D ou en 3D. Il est très utilisé pour les jeux vidéo ou les animations.</p> <p>Dans un fichier <code>index.js</code>, créez deux constantes <code>WIDTH</code> et <code>HEIGHT</code> qui définiront la taille du canvas. Vous pouvez les initialiser à 800 et 600 par exemple. Créez un élément canvas avec ces dimensions et ajoutez-le au <code>body</code> de la page.</p> <p>Pour mieux voir les particules, vous pouvez ajouter un fond noir au canvas, dans un fichier <code>style.css</code> :</p> <!----><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#22863A">canvas</span><span style="color:#24292E"> &#123;</span></span>
<span class="line"><span style="color:#005CC5">	background-color</span><span style="color:#24292E">: </span><span style="color:#005CC5">black</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">&#125;</span></span></code></pre><!----> <h3>2. Création de la classe <code>Particle</code></h3> <p>Créer une classe <code>Particle</code> qui contiendra les méthodes suivantes :</p> <ul><li><p><code>constructor(x, y, dx, dy, color)</code> : initialise une nouvelle particule avec les paramètres suivants :</p> <ul><li><code>x</code> : la position en x de la particule</li> <li><code>y</code> : la position en y de la particule</li> <li><code>dx</code> : la vitesse en x de la particule</li> <li><code>dy</code> : la vitesse en y de la particule</li></ul> <p>Cette méthode initialisera également la couleur de la particule. Pour générer une couleur aléatoire, vous pouvez utiliser la fonction suivante :</p> <!----><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#D73A49">function</span><span style="color:#6F42C1"> randomColor</span><span style="color:#24292E">() &#123;</span></span>
<span class="line"><span style="color:#D73A49">	return</span><span style="color:#032F62"> &#96;hsl($&#123;</span><span style="color:#24292E">Math</span><span style="color:#032F62">.</span><span style="color:#6F42C1">random</span><span style="color:#032F62">() </span><span style="color:#D73A49">*</span><span style="color:#005CC5"> 360</span><span style="color:#032F62">&#125;, $&#123;</span><span style="color:#005CC5">50</span><span style="color:#D73A49"> +</span><span style="color:#24292E"> Math</span><span style="color:#032F62">.</span><span style="color:#6F42C1">random</span><span style="color:#032F62">() </span><span style="color:#D73A49">*</span><span style="color:#005CC5"> 50</span><span style="color:#032F62">&#125;%, $&#123;</span><span style="color:#005CC5">50</span><span style="color:#D73A49"> +</span><span style="color:#24292E"> Math</span><span style="color:#032F62">.</span><span style="color:#6F42C1">random</span><span style="color:#032F62">() </span><span style="color:#D73A49">*</span><span style="color:#005CC5"> 50</span><span style="color:#032F62">&#125;%)&#96;</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">&#125;</span></span></code></pre><!----></li> <li><p><code>update()</code> : met à jour la position de la particule en fonction de sa vitesse
Lorsque la particule atteint le bord du canvas, elle doit rebondir.</p></li> <li><p><code>draw(ctx)</code> : dessine la particule sur le canvas
Pour la couleur, vous pouvez utiliser la méthode <code>fillStyle</code> du contexte 2D.
Vous pouvez utiliser la méthode <code>fillRect</code> du contexte 2D du canvas (ctx) pour dessiner un rectangle de 2 pixels de côté.</p></li></ul> <h3>3. Création du système de particules</h3> <p>Initialisez un tableau de particules dans le fichier <code>index.js</code>. Ce tableau sera initialisé avec un nombre de particules spécifié dans une constante <code>PARTICLE_COUNT</code>.</p> <p>Pour cela, on crée une fonction <code>renderParticles</code> qui dessinera toutes les particules du tableau. Elle appellera la méthode <code>update</code> de chaque particule pour les faire bouger, puis la méthode <code>draw</code> pour les dessiner.</p> <p>Cette fonction devra être appellée à intervalles réguliers pour animer les particules. Vous pouvez utiliser la fonction <code>requestAnimationFrame</code> pour cela. Elle est plus adaptée que <code>setInterval</code> pour les animations, car elle est synchronisée avec le taux de rafraîchissement du navigateur.</p> <h3>4. Explosion au clic</h3> <p>Ajoutez un écouteur d’événement sur le canvas pour détecter les clics de souris. Lorsque l’utilisateur clique, une explosion de particules doit se produire à l’endroit du clic.</p> <p>Pour cela, vous pouvez ajouter une méthode <code>explode(x, y)</code> qui ajoutera des particules autour du point <code>(x, y)</code>.</p> <h3>5. Champs de force gravitationnel</h3> <p>Ajoutez un champ de force gravitationnel autour de la souris. Lorsque l’utilisateur bouge la souris, les particules doivent être repoussées par la souris.</p> <p>Pour cela, vous devrez modifier la vitesse par rapport à la position de souris.</p> <p>Vous pouvez utiliser la formule suivante :</p> <!----><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#D73A49">const</span><span style="color:#005CC5"> angle</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> Math.</span><span style="color:#6F42C1">atan2</span><span style="color:#24292E">(mouseY </span><span style="color:#D73A49">-</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.y, mouseX </span><span style="color:#D73A49">-</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.x);</span></span>
<span class="line"><span style="color:#005CC5">this</span><span style="color:#24292E">.dx </span><span style="color:#D73A49">+=</span><span style="color:#24292E"> Math.</span><span style="color:#6F42C1">cos</span><span style="color:#24292E">(angle);</span></span>
<span class="line"><span style="color:#005CC5">this</span><span style="color:#24292E">.dy </span><span style="color:#D73A49">+=</span><span style="color:#24292E"> Math.</span><span style="color:#6F42C1">sin</span><span style="color:#24292E">(angle);</span></span></code></pre><!----> <ul><li>Faire en sorte que le champs de force ne s’applique qu’à une certaine distance de la souris.</li> <li>Faire en sorte que les particules hors de cette distance rallentissent progressivement.</li> <li>Faire en sorte de pouvoir paramétrer la force du champs de force.</li> <li>Faire en sorte que le champs de force dépende de la distance à la souris.</li> <li>Modifier les différents paramètres jusq’à obtenir un résultat qui vous plait.</li></ul> <h2>Corrigé</h2> <!--[--><div class="-ml-5 border-l-2 border-dotted border-pink-500 pl-4"><span class="mr-2 inline-block rounded-full bg-pink-500 px-2 py-1 text-sm font-semibold text-white">Corrigé</span> <button class="inline-block text-sm text-gray-500 hover:text-gray-700" aria-label="Afficher la solution" aria-expanded="false" aria-controls="oovxzu66zf"><!--[!-->Afficher<!--]--></button> <!--[!--><!--]--></div><!--]--><!----><!----><!--]--><!----><!----><!--]--><!----></main></div><!----><!--]--><!----></div><!----><!--]--> <!--[!--><!--]--><!--]-->
			
			<script>
				{
					__sveltekit_pqo0dy = {
						base: new URL("../../..", location).pathname.slice(0, -1)
					};

					const element = document.currentScript.parentElement;

					Promise.all([
						import("../../../_app/immutable/entry/start.Bnp5303b.js"),
						import("../../../_app/immutable/entry/app.gFT0rYy9.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 2, 3, 12],
							data: [{"type":"data","data":null,"uses":{}},null,null,null],
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
	</body>
</html>
